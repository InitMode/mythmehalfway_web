<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Myth Me Halfway â€“ Story Library</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;800&family=Merriweather:wght@300;400;700&family=Lato:wght@300;400;700&family=Source+Code+Pro:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #8a2be2;
            --primary-dark: #5d0e9e;
            --primary-light: #9d4edd;
            --secondary: #4169e1;
            --accent: #4cc9f0;
            --bg-dark: #0a0a1a;
            --bg-darker: #050510;
            --card-dark: #1a1a2e;
            --card-darker: #141428;
            --text-light: #e8e8f0;
            --text-lighter: #f5f5ff;
            --text-muted: #a0a0c0;
            --border-dark: #2d2d44;
            --border-light: #3a3a5e;
            --success: #4CAF50;
            --warning: #ff9800;
            --danger: #ff4757;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --shadow-light: 0 4px 16px rgba(138, 43, 226, 0.2);
            --radius: 12px;
            --radius-sm: 8px;
            --radius-lg: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --font-heading: 'Cinzel', serif;
            --font-title: 'Merriweather', serif;
            --font-body: 'Lato', sans-serif;
            --font-code: 'Source Code Pro', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            line-height: 1.6;
            background: linear-gradient(135deg, var(--bg-darker) 0%, var(--bg-dark) 100%);
            color: var(--text-light);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }

        /* App Container */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
            padding-top: 120px;
        }

        /* App Header - Fixed with blur */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(10, 10, 26, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(45, 45, 68, 0.3);
            padding: 1rem 0;
        }

        .header-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 24px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        /* Brand */
        .brand {
            display: flex;
            align-items: center;
            gap: 1.2rem;
            text-decoration: none;
        }

        .brand-icon {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 2px 8px rgba(138, 43, 226, 0.3));
        }

        .brand-text {
            display: flex;
            flex-direction: column;
        }

        .brand-title {
            font-family: var(--font-heading);
            font-size: 2rem;
            font-weight: 800;
            letter-spacing: 1px;
            line-height: 1;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .brand-subtitle {
            font-family: var(--font-code);
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 0.3rem;
            letter-spacing: 1px;
        }

        /* Header Controls */
        .header-controls {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
            flex: 1;
            justify-content: flex-end;
        }

        /* Search Bar */
        .search-container {
            position: relative;
            flex: 1;
            min-width: 320px;
            max-width: 500px;
        }

        .search-input {
            width: 100%;
            padding: 0.9rem 1.2rem 0.9rem 3.5rem;
            background: rgba(26, 26, 46, 0.7);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(138, 43, 226, 0.2);
            border-radius: 50px;
            color: var(--text-light);
            font-size: 1rem;
            font-family: var(--font-body);
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .search-input::placeholder {
            color: var(--text-muted);
            font-family: var(--font-body);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(138, 43, 226, 0.1), 0 8px 24px rgba(0, 0, 0, 0.3);
            background: rgba(26, 26, 46, 0.9);
        }

        .search-icon {
            position: absolute;
            left: 1.2rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 1.1rem;
            transition: var(--transition);
        }

        .search-input:focus + .search-icon {
            color: var(--primary);
        }

        /* Filter Tags */
        .filter-container {
            position: relative;
            margin: 1rem 0;
        }

        .filter-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem 1.2rem;
            background: rgba(138, 43, 226, 0.1);
            border: 2px solid rgba(138, 43, 226, 0.3);
            border-radius: var(--radius-sm);
            color: var(--text-light);
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-toggle:hover {
            background: rgba(138, 43, 226, 0.2);
            border-color: var(--primary);
        }

        .filter-toggle i {
            transition: var(--transition);
        }

        .filter-toggle.active i {
            transform: rotate(180deg);
        }

        .filter-panel {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card-darker);
            border: 1px solid var(--border-dark);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-top: 0.5rem;
            display: none;
            flex-direction: column;
            gap: 1rem;
            box-shadow: var(--shadow);
            z-index: 100;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .filter-panel.active {
            display: flex;
        }

        .filter-section {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .filter-section h4 {
            font-family: var(--font-heading);
            font-size: 1rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .filter-tag {
            padding: 0.6rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: var(--text-muted);
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-tag:hover {
            background: rgba(138, 43, 226, 0.1);
            color: var(--text-light);
            transform: translateY(-2px);
        }

        .filter-tag.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(138, 43, 226, 0.3);
        }

        /* Header Actions */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            transition: var(--transition);
            position: relative;
        }

        .action-btn:hover {
            background: rgba(138, 43, 226, 0.2);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
        }

        .action-btn .tooltip {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-darker);
            color: var(--text-light);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            margin-top: 0.5rem;
            border: 1px solid var(--border-dark);
            z-index: 1000;
        }

        .action-btn:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        .theme-toggle.active {
            background: var(--primary);
            color: white;
        }

        /* Continue Reading Section */
        .continue-reading-section {
            background: var(--card-dark);
            border-radius: var(--radius);
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-dark);
            position: relative;
            overflow: hidden;
        }

        .continue-reading-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .section-title i {
            font-size: 1.3rem;
            color: var(--primary);
        }

        /* Continue Reading Cards */
        .continue-reading-cards {
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            padding: 0.5rem 0.5rem 1.5rem;
            scrollbar-width: thin;
        }

        .continue-reading-cards::-webkit-scrollbar {
            height: 6px;
        }

        .continue-reading-cards::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .continue-reading-cards::-webkit-scrollbar-thumb {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 3px;
        }

        .continue-card {
            min-width: 280px;
            max-width: 280px;
            height: 160px;
            background: var(--card-darker);
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
            cursor: pointer;
            flex-shrink: 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-dark);
            transition: var(--transition);
        }

        .continue-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
            border-color: var(--primary);
        }

        .continue-card-bg {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-size: cover;
            background-position: center;
            filter: brightness(0.4);
            transition: var(--transition);
        }

        .continue-card:hover .continue-card-bg {
            filter: brightness(0.6);
            transform: scale(1.05);
        }

        .continue-card-content {
            position: relative;
            z-index: 2;
            padding: 1.2rem;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            color: white;
        }

        .continue-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .continue-card-title {
            font-family: var(--font-title);
            font-weight: 600;
            font-size: 1.1rem;
            line-height: 1.4;
            margin-bottom: 0.5rem;
            flex: 1;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .continue-card-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            cursor: pointer;
            flex-shrink: 0;
            margin-left: 0.5rem;
            transition: var(--transition);
        }

        .continue-card-close:hover {
            background: rgba(255, 71, 87, 0.3);
            color: var(--danger);
        }

        .continue-card-progress {
            background: rgba(255, 255, 255, 0.1);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .continue-card-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            width: 0%;
            border-radius: 3px;
            transition: width 0.6s ease;
        }

        .continue-card-meta {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Stats Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--card-dark);
            border-radius: var(--radius);
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-dark);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
            border-color: var(--primary-light);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .stat-info {
            flex: 1;
        }

        .stat-value {
            font-family: var(--font-heading);
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--text-light);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 0.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            padding-bottom: 4rem;
        }

        /* Story Card */
        .story-card {
            background: var(--card-dark);
            border-radius: var(--radius);
            overflow: hidden;
            cursor: pointer;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-dark);
            position: relative;
            transition: var(--transition);
            height: 380px;
            display: flex;
            flex-direction: column;
        }

        .story-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            border-color: var(--primary);
        }

        .story-card-image {
            height: 180px;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
        }

        .story-card-image::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(to top, var(--card-dark), transparent);
        }

        .story-card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.8) 100%);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 1.5rem;
            opacity: 0;
            transition: var(--transition);
            z-index: 2;
        }

        .story-card:hover .story-card-overlay {
            opacity: 1;
        }

        .story-card-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .story-card-tag {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(4px);
            padding: 0.3rem 0.8rem;
            border-radius: 12px;
            font-size: 0.7rem;
            color: white;
            white-space: nowrap;
        }

        .story-card-content {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .story-card-header {
            margin-bottom: 0.8rem;
        }

        .story-card-title {
            font-family: var(--font-title);
            font-weight: 700;
            font-size: 1.2rem;
            line-height: 1.4;
            margin-bottom: 0.5rem;
            color: var(--text-light);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .story-card-author {
            font-size: 0.9rem;
            color: var(--primary-light);
            font-weight: 500;
        }

        .story-card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .story-card-type {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .story-card-time {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: var(--warning);
        }

        .story-card-description {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.6;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .story-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid var(--border-dark);
        }

        .story-card-progress {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
            overflow: hidden;
            margin-right: 1rem;
        }

        .story-card-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            border-radius: 3px;
            transition: width 0.6s ease;
        }

        .story-card-actions {
            display: flex;
            gap: 0.5rem;
            opacity: 0;
            transform: translateY(10px);
            transition: var(--transition);
        }

        .story-card:hover .story-card-actions {
            opacity: 1;
            transform: translateY(0);
        }

        .story-card-btn {
            background: transparent;
            border: 2px solid var(--border-dark);
            color: var(--text-muted);
            font-size: 0.9rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .story-card-btn:hover {
            background: rgba(138, 43, 226, 0.1);
            color: var(--primary);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .story-card-btn.active {
            background: rgba(138, 43, 226, 0.2);
            color: var(--primary);
            border-color: var(--primary);
        }

        /* Empty State */
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.3;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .empty-state h3 {
            font-family: var(--font-heading);
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--text-light);
        }

        .empty-state p {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .empty-state .reset-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem 1.8rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .empty-state .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(138, 43, 226, 0.3);
        }

        /* FAB Menu */
        .fab-container {
            position: fixed;
            bottom: 2.5rem;
            right: 2.5rem;
            z-index: 1000;
        }

        .fab-main {
            width: 64px;
            height: 64px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            transition: var(--transition);
            position: relative;
            z-index: 2;
        }

        .fab-main:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5);
        }

        .fab-main i {
            transition: var(--transition);
        }

        .fab-main.active i {
            transform: rotate(135deg);
        }

        .fab-menu {
            position: absolute;
            bottom: 80px;
            right: 0;
            background: var(--card-darker);
            border-radius: var(--radius-lg);
            padding: 1.2rem;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4);
            display: none;
            flex-direction: column;
            gap: 0.8rem;
            min-width: 200px;
            border: 1px solid var(--border-dark);
            z-index: 1;
        }

        .fab-menu.active {
            display: flex;
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .fab-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.2rem;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            color: var(--text-light);
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .fab-item:hover {
            background: rgba(138, 43, 226, 0.1);
            color: var(--primary);
            transform: translateX(-5px);
        }

        .fab-item i {
            width: 24px;
            font-size: 1.2rem;
        }

        .fab-item .badge {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary);
            color: white;
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }

        /* Audio Dialog */
        .audio-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-darker);
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: 0 32px 64px rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            flex-direction: column;
            gap: 1.5rem;
            width: 400px;
            max-width: 90vw;
            border: 1px solid var(--border-dark);
            backdrop-filter: blur(20px);
        }

        .audio-dialog.active {
            display: flex;
            animation: modalFadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -40%) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .audio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .audio-title {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-light);
        }

        .audio-close {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 1.2rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .audio-close:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-light);
        }

        .audio-options {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .audio-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.2rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-sm);
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .audio-option:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
        }

        .audio-option.active {
            background: rgba(138, 43, 226, 0.1);
            border-color: var(--primary);
        }

        .audio-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .audio-icon {
            width: 48px;
            height: 48px;
            background: rgba(138, 43, 226, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.3rem;
            transition: var(--transition);
        }

        .audio-option.active .audio-icon {
            background: var(--primary);
            color: white;
        }

        .audio-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-light);
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .audio-volume {
            width: 100px;
            -webkit-appearance: none;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
        }

        .audio-volume::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 5, 16, 0.9);
            backdrop-filter: blur(20px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--card-darker);
            width: 90%;
            max-width: 900px;
            height: 90vh;
            border-radius: var(--radius-lg);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 40px 80px rgba(0, 0, 0, 0.6);
            border: 1px solid var(--border-dark);
            animation: modalScale 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-header {
            padding: 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-family: var(--font-heading);
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .modal-body {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            line-height: 1.8;
            font-size: 1.1rem;
            color: var(--text-light);
        }

        .modal-body h1, .modal-body h2, .modal-body h3 {
            font-family: var(--font-title);
            margin: 1.5rem 0 1rem;
            color: var(--text-light);
        }

        .modal-body h1 {
            font-size: 2rem;
            color: var(--primary-light);
        }

        .modal-body h2 {
            font-size: 1.5rem;
        }

        .modal-body p {
            margin-bottom: 1.2rem;
        }

        .modal-body strong {
            color: var(--primary-light);
            font-weight: 700;
        }

        .modal-controls {
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-dark);
            border-top: 1px solid var(--border-dark);
        }

        .page-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .page-input {
            width: 80px;
            padding: 0.8rem 1rem;
            background: var(--bg-dark);
            border: 2px solid var(--border-dark);
            border-radius: var(--radius-sm);
            color: var(--text-light);
            font-size: 1rem;
            text-align: center;
            transition: var(--transition);
        }

        .page-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.1);
        }

        .page-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            box-shadow: 0 4px 16px rgba(138, 43, 226, 0.3);
            transition: var(--transition);
        }

        .page-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(138, 43, 226, 0.4);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .modal-actions {
            display: flex;
            gap: 0.8rem;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 2rem;
            border-radius: 50px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 2001;
            opacity: 0;
            transition: var(--transition);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--text-muted);
            font-size: 1.1rem;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-dark);
            border-top-color: var(--primary);
            border-radius: 50%;
            margin-left: 1rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .app-container {
                padding: 0 20px;
                padding-top: 110px;
            }
            
            .header-wrapper {
                padding: 0 20px;
            }
            
            .main-content {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }

        @media (max-width: 992px) {
            .header-content {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .header-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-container {
                max-width: 100%;
                min-width: auto;
            }
            
            .filter-container {
                order: 1;
            }
            
            .continue-card {
                min-width: 240px;
                height: 140px;
            }
            
            .main-content {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1.5rem;
            }
            
            .story-card {
                height: 350px;
            }
            
            .story-card-image {
                height: 160px;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 0 16px;
                padding-top: 100px;
            }
            
            .header-wrapper {
                padding: 0 16px;
            }
            
            .brand-title {
                font-size: 1.6rem;
            }
            
            .brand-icon {
                font-size: 2rem;
            }
            
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .stat-card {
                padding: 1.2rem;
            }
            
            .stat-icon {
                width: 48px;
                height: 48px;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
            
            .main-content {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
                gap: 1rem;
            }
            
            .story-card {
                height: 320px;
            }
            
            .story-card-image {
                height: 140px;
            }
            
            .continue-card {
                min-width: 200px;
            }
            
            .fab-container {
                bottom: 2rem;
                right: 2rem;
            }
        }

        @media (max-width: 576px) {
            .app-container {
                padding: 0 12px;
                padding-top: 90px;
            }
            
            .header-wrapper {
                padding: 0 12px;
            }
            
            .brand-title {
                font-size: 1.4rem;
            }
            
            .brand-subtitle {
                font-size: 0.75rem;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .story-card {
                height: auto;
                min-height: 380px;
            }
            
            .continue-card {
                min-width: 180px;
                height: 120px;
            }
            
            .modal-content {
                width: 95%;
                height: 95vh;
            }
            
            .modal-header {
                padding: 1.5rem;
            }
            
            .modal-body {
                padding: 1.5rem;
            }
            
            .fab-container {
                bottom: 1.5rem;
                right: 1.5rem;
            }
            
            .fab-main {
                width: 56px;
                height: 56px;
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <!-- Audio Dialog -->
    <div class="audio-dialog" id="audioDialog">
        <div class="audio-header">
            <h3 class="audio-title">Background Sounds</h3>
            <button class="audio-close" id="closeAudioDialog">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="audio-options" id="audioOptions">
            <!-- Audio options will be inserted here -->
        </div>
    </div>

    <!-- App Header -->
    <header class="app-header">
        <div class="header-wrapper">
            <div class="header-content">
                <a href="#" class="brand">
                    <div class="brand-icon">
                        <i class="fas fa-book-sparkles"></i>
                    </div>
                    <div class="brand-text">
                        <h1 class="brand-title">Myth Me Halfway</h1>
                        <div class="brand-subtitle">Story Library <span id="currentYear"></span></div>
                    </div>
                </a>

                <div class="header-controls">
                    <!-- Search Bar -->
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchInput" class="search-input" placeholder="Search stories, authors, tags...">
                    </div>

                    <!-- Filter Panel -->
                    <div class="filter-container">
                        <button class="filter-toggle" id="filterToggle">
                            <i class="fas fa-filter"></i>
                            Filters
                        </button>
                        <div class="filter-panel" id="filterPanel">
                            <div class="filter-section">
                                <h4>Story Type</h4>
                                <div class="filter-tags" id="typeFilters">
                                    <!-- Type filters will be inserted here -->
                                </div>
                            </div>
                            <div class="filter-section">
                                <h4>Tags</h4>
                                <div class="filter-tags" id="tagFilters">
                                    <!-- Tag filters will be inserted here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="header-actions">
                    <button class="action-btn theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                        <span class="tooltip">Toggle Theme</span>
                    </button>
                    <button class="action-btn" id="audioToggle">
                        <i class="fas fa-music"></i>
                        <span class="tooltip">Background Sounds</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- App Container -->
    <div class="app-container">
        <!-- Continue Reading Section -->
        <div class="continue-reading-section" id="continueReadingSection">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-play-circle"></i>
                    Continue Reading
                </h3>
            </div>
            <div class="continue-reading-cards" id="continueReadingCards">
                <!-- Continue reading cards will be inserted here -->
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="totalStories">0</div>
                    <div class="stat-label">Total Stories</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-bookmark"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="bookmarkedCount">0</div>
                    <div class="stat-label">Bookmarked</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="totalReadTime">0</div>
                    <div class="stat-label">Minutes Read</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-value" id="likedCount">0</div>
                    <div class="stat-label">Liked Stories</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content" id="storiesContainer">
            <!-- Story cards will be inserted here -->
        </main>
    </div>

    <!-- Story Modal -->
    <div class="modal" id="storyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Story Title</h2>
                <button class="modal-close" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modalStoryContent">
                <!-- Story content will be inserted here -->
            </div>
            <div class="modal-controls">
                <div class="page-controls">
                    <button class="page-btn" id="prevPageBtn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <input type="number" id="pageInput" class="page-input" min="1" value="1">
                    <span id="totalPages">/ 1</span>
                    <button class="page-btn" id="nextPageBtn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="modal-actions">
                    <button class="action-btn" id="modalBookmarkBtn" title="Bookmark">
                        <i class="far fa-bookmark"></i>
                    </button>
                    <button class="action-btn" id="modalLikeBtn" title="Like">
                        <i class="far fa-heart"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- FAB Menu -->
    <div class="fab-container">
        <div class="fab-menu" id="fabMenu">
            <button class="fab-item" id="fabBookmarks">
                <i class="fas fa-bookmark"></i>
                <span>Bookmarks</span>
                <span class="badge" id="bookmarkBadge">0</span>
            </button>
            <button class="fab-item" id="fabLikes">
                <i class="fas fa-heart"></i>
                <span>Liked Stories</span>
                <span class="badge" id="likeBadge">0</span>
            </button>
            <button class="fab-item" id="fabHistory">
                <i class="fas fa-history"></i>
                <span>Reading History</span>
                <span class="badge" id="historyBadge">0</span>
            </button>
        </div>
        <button class="fab-main" id="fabMain">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Action completed</span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Constants and Configuration ---
            const BASE_PATH = window.location.pathname.replace(/\/$/, "");
            const API_BASE = BASE_PATH + "/api";
            const STORIES_INDEX = API_BASE + "/stories/index.json";
            
            // Sounds configuration
            const SOUNDS = [
                { id: 'rain', name: 'Heavy Rain', icon: 'fa-cloud-rain', url: 'https://actions.google.com/sounds/v1/weather/rain_heavy_loud.ogg' },
                { id: 'fire', name: 'Campfire', icon: 'fa-fire', url: 'https://actions.google.com/sounds/v1/ambiences/fire.ogg' },
                { id: 'coffee', name: 'Coffee Shop', icon: 'fa-mug-hot', url: 'https://actions.google.com/sounds/v1/ambiences/coffee_shop.ogg' },
                { id: 'forest', name: 'Forest', icon: 'fa-tree', url: 'https://actions.google.com/sounds/v1/nature/forest_wind.ogg' },
                { id: 'ocean', name: 'Ocean Waves', icon: 'fa-water', url: 'https://actions.google.com/sounds/v1/weather/ocean_waves.ogg' }
            ];
            
            // Reading configuration
            const WORDS_PER_PAGE = 300;
            const WORDS_PER_MINUTE = 200;
            
            // --- State Management ---
            let allStories = [];
            let displayedStories = [];
            let allTypes = new Set();
            let allTags = new Set();
            let activeFilters = {
                type: 'all',
                tags: new Set()
            };
            let searchQuery = '';
            let searchTimeout = null;
            let currentStoryData = null;
            let currentStoryPages = [];
            let currentPage = 1;
            let currentView = 'all'; // 'all', 'bookmarked', 'liked', 'history'
            let activeSound = null;
            let audioElements = {};
            
            // --- Local Storage Keys ---
            const STORAGE_KEYS = {
                THEME: 'mythmehalfway_theme',
                BOOKMARKS: 'mythmehalfway_bookmarks',
                READING_PROGRESS: 'mythmehalfway_reading_progress',
                READING_HISTORY: 'mythmehalfway_reading_history',
                LIKES: 'mythmehalfway_likes',
                SOUND: 'mythmehalfway_sound',
                VOLUME: 'mythmehalfway_volume'
            };
            
            // --- DOM Elements ---
            const currentYearEl = document.getElementById('currentYear');
            const themeToggle = document.getElementById('themeToggle');
            const searchInput = document.getElementById('searchInput');
            const filterToggle = document.getElementById('filterToggle');
            const filterPanel = document.getElementById('filterPanel');
            const typeFilters = document.getElementById('typeFilters');
            const tagFilters = document.getElementById('tagFilters');
            const audioToggle = document.getElementById('audioToggle');
            const audioDialog = document.getElementById('audioDialog');
            const closeAudioDialog = document.getElementById('closeAudioDialog');
            const audioOptions = document.getElementById('audioOptions');
            const continueReadingSection = document.getElementById('continueReadingSection');
            const continueReadingCards = document.getElementById('continueReadingCards');
            const totalStoriesEl = document.getElementById('totalStories');
            const bookmarkedCountEl = document.getElementById('bookmarkedCount');
            const totalReadTimeEl = document.getElementById('totalReadTime');
            const likedCountEl = document.getElementById('likedCount');
            const storiesContainer = document.getElementById('storiesContainer');
            const storyModal = document.getElementById('storyModal');
            const closeModal = document.getElementById('closeModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalStoryContent = document.getElementById('modalStoryContent');
            const prevPageBtn = document.getElementById('prevPageBtn');
            const nextPageBtn = document.getElementById('nextPageBtn');
            const pageInput = document.getElementById('pageInput');
            const totalPagesEl = document.getElementById('totalPages');
            const modalBookmarkBtn = document.getElementById('modalBookmarkBtn');
            const modalLikeBtn = document.getElementById('modalLikeBtn');
            const fabMain = document.getElementById('fabMain');
            const fabMenu = document.getElementById('fabMenu');
            const fabBookmarks = document.getElementById('fabBookmarks');
            const fabLikes = document.getElementById('fabLikes');
            const fabHistory = document.getElementById('fabHistory');
            const bookmarkBadge = document.getElementById('bookmarkBadge');
            const likeBadge = document.getElementById('likeBadge');
            const historyBadge = document.getElementById('historyBadge');
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            // --- Initialize ---
            function init() {
                currentYearEl.textContent = new Date().getFullYear();
                initTheme();
                initAudio();
                initEventListeners();
                loadStories();
                updateBadges();
            }
            
            // --- Theme Management ---
            function initTheme() {
                const savedTheme = localStorage.getItem(STORAGE_KEYS.THEME);
                if (savedTheme === 'light') {
                    document.body.classList.remove('dark-mode');
                    themeToggle.innerHTML = '<i class="fas fa-sun"></i><span class="tooltip">Light Mode</span>';
                    themeToggle.classList.add('active');
                } else {
                    document.body.classList.add('dark-mode');
                    themeToggle.innerHTML = '<i class="fas fa-moon"></i><span class="tooltip">Dark Mode</span>';
                }
            }
            
            // --- Audio Management ---
            function initAudio() {
                SOUNDS.forEach(sound => {
                    const audioOption = document.createElement('div');
                    audioOption.className = 'audio-option';
                    audioOption.dataset.soundId = sound.id;
                    
                    const audioInfo = document.createElement('div');
                    audioInfo.className = 'audio-info';
                    
                    const audioIcon = document.createElement('div');
                    audioIcon.className = 'audio-icon';
                    audioIcon.innerHTML = `<i class="fas ${sound.icon}"></i>`;
                    
                    const audioName = document.createElement('div');
                    audioName.className = 'audio-name';
                    audioName.textContent = sound.name;
                    
                    const audioControls = document.createElement('div');
                    audioControls.className = 'audio-controls';
                    
                    const volumeSlider = document.createElement('input');
                    volumeSlider.type = 'range';
                    volumeSlider.className = 'audio-volume';
                    volumeSlider.min = '0';
                    volumeSlider.max = '100';
                    volumeSlider.value = '50';
                    
                    audioInfo.appendChild(audioIcon);
                    audioInfo.appendChild(audioName);
                    audioControls.appendChild(volumeSlider);
                    
                    audioOption.appendChild(audioInfo);
                    audioOption.appendChild(audioControls);
                    
                    audioOption.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('audio-volume')) {
                            toggleSound(sound.id);
                        }
                    });
                    
                    volumeSlider.addEventListener('input', (e) => {
                        e.stopPropagation();
                        updateVolume(sound.id, e.target.value / 100);
                    });
                    
                    audioOptions.appendChild(audioOption);
                    
                    // Create audio element
                    const audio = new Audio(sound.url);
                    audio.loop = true;
                    audio.volume = 0.5;
                    audioElements[sound.id] = audio;
                });
                
                const savedSound = localStorage.getItem(STORAGE_KEYS.SOUND);
                const savedVolume = localStorage.getItem(STORAGE_KEYS.VOLUME) || 0.5;
                
                if (savedSound && audioElements[savedSound]) {
                    audioElements[savedSound].volume = parseFloat(savedVolume);
                    const option = document.querySelector(`.audio-option[data-sound-id="${savedSound}"]`);
                    if (option) option.classList.add('active');
                    activeSound = savedSound;
                }
            }
            
            // --- Story Data Management ---
            async function loadStories() {
                // Demo stories with enhanced content
                const demoStories = [
                    {
                        id: 'the-girl-who-borrowed-the-wind',
                        title: "The Girl Who Borrowed the Wind",
                        author: "Salt Merchant",
                        cover: "https://source.unsplash.com/featured/?baobab,african+landscape",
                        description: "A short magical tale from Ukambani about courage, sacrifice, and the Wind Spirit Mwenga Mkuu.",
                        type: "African Mythology",
                        tags: ["African mythology", "Kenyan folklore", "magical realism", "short story", "children's story", "courage", "sacrifice"],
                        content: `# The Girl Who Borrowed the Wind

In the drought-stricken plains of Ukambani, there lived a young girl named Mumo.  
Her village had not felt a breeze in many moons, and the wells were turning into dust.

One evening, Mumo wandered to the sacred hill where the old stories say the **Wind Spirit**,  
_Mwenga Mkuu_, sleeps inside a giant baobab tree.  
Most children feared the placeâ€”but Mumo was brave.

She placed her palms on the rough bark.

> "Great Mwenga," she whispered.  
> "My people grow weak. Please, wake, even for a moment."

The baobab groaned.  
A cool swirl of air wrapped around her wrists like bracelets of morning mist.

The Wind Spirit spoke:

> "Child of courage, I can lend you a breeze.  
> But when I give, something must be returned."

Mumo thought hard. She had no water.  
She had no cattle.  
But she had her voice.

So she offered it.

> "Take my songs, Mwenga.  
> My voice carries stories, and stories are part of the wind."

The spirit agreed.  
A powerful gust spiraled into her hands, glowing like soft blue fire.

Mumo ran home, releasing the wind across the dry fields.  
Clouds gathered, rain fell, children danced.

But Mumo could no longer sing.

Weeks later, the Wind Spirit returned, moved by her sacrifice.  
It placed a warm breeze in her throat.

> "Your songs are now part of every wind," it said.  
> "Each time the breeze touches your village, it brings your voice home."

And so the people of Ukambani say that when the wind hums through the baobab trees,  
you can hear a soft girl's songâ€”  
a reminder of Mumo, who borrowed the wind to save her people.`
                    },
                    {
                        id: 'whispering-stones',
                        title: "The Whispering Stones",
                        author: "Ancient Storyteller",
                        cover: "https://source.unsplash.com/featured/?ancient+stones,desert",
                        description: "In the heart of the Sahara, three travelers discover stones that remember every story ever told.",
                        type: "Mythology",
                        tags: ["ancient", "stones", "wisdom", "desert", "memory", "legends"],
                        content: `# The Whispering Stones`
                    },
                    {
                        id: 'river-dreams',
                        title: "River of Dreams",
                        author: "Dream Weaver",
                        cover: "https://source.unsplash.com/featured/?river,fantasy",
                        description: "A river that flows through the dreamworld carries messages between sleepers.",
                        type: "Fantasy",
                        tags: ["dreams", "river", "journey", "discovery", "magic"],
                        content: `# River of Dreams`
                    },
                    {
                        id: 'last-firekeeper',
                        title: "The Last Firekeeper",
                        author: "Flame Guardian",
                        cover: "https://source.unsplash.com/featured/?fire,medieval",
                        description: "In a world growing cold, one woman keeps the last eternal flame burning.",
                        type: "Folklore",
                        tags: ["fire", "guardian", "tradition", "sacrifice", "winter"],
                        content: `# The Last Firekeeper`
                    },
                    {
                        id: 'moonlight-promise',
                        title: "Moonlight's Promise",
                        author: "Night Watcher",
                        cover: "https://source.unsplash.com/featured/?moon,night",
                        description: "Every full moon, a promise made under its light must be keptâ€”or forgotten forever.",
                        type: "Romance",
                        tags: ["moon", "promise", "love", "destiny", "magic"],
                        content: `# Moonlight's Promise`
                    },
                    {
                        id: 'echoes-mountain',
                        title: "Echoes of the Mountain",
                        author: "Highlander",
                        cover: "https://source.unsplash.com/featured/?mountain,echo",
                        description: "The mountains remember every voice that has ever echoed through their valleys.",
                        type: "Adventure",
                        tags: ["mountain", "echoes", "spirits", "adventure", "memory"],
                        content: `# Echoes of the Mountain`
                    },
                    {
                        id: 'star-weaver',
                        title: "The Star Weaver",
                        author: "Cosmic Dreamer",
                        cover: "https://source.unsplash.com/featured/?stars,night+sky",
                        description: "An ancient being who weaves the constellations and listens to their stories.",
                        type: "Science Fiction",
                        tags: ["stars", "cosmic", "weaving", "creation", "myth"],
                        content: `# The Star Weaver`
                    },
                    {
                        id: 'silent-library',
                        title: "The Silent Library",
                        author: "Book Keeper",
                        cover: "https://source.unsplash.com/featured/?library,ancient",
                        description: "A library where books don't hold words, but the memories of those who wrote them.",
                        type: "Mystery",
                        tags: ["library", "books", "memory", "mystery", "knowledge"],
                        content: `# The Silent Library`
                    }
                ];
                
                // Add word count and read time
                allStories = demoStories.map(story => {
                    const wordCount = story.content.split(/\s+/).length;
                    const readTime = Math.max(1, Math.ceil(wordCount / WORDS_PER_MINUTE));
                    
                    return {
                        ...story,
                        wordCount,
                        readTime,
                        filename: `${story.id}.md`,
                        path: `${API_BASE}/stories/${story.id}.md`
                    };
                });
                
                // Extract all types and tags
                allTypes.clear();
                allTags.clear();
                
                allStories.forEach(story => {
                    if (story.type) allTypes.add(story.type);
                    if (story.tags && Array.isArray(story.tags)) {
                        story.tags.forEach(tag => allTags.add(tag));
                    }
                });
                
                // Initialize filters
                initFilters();
                
                // Apply current view
                displayedStories = [...allStories];
                applyFilters();
                
                // Update UI
                updateContinueReading();
                updateStats();
                updateBadges();
            }
            
            function initFilters() {
                typeFilters.innerHTML = '';
                tagFilters.innerHTML = '';
                
                // Add "All" type filter
                const allTypeFilter = document.createElement('span');
                allTypeFilter.className = 'filter-tag active';
                allTypeFilter.textContent = 'All Types';
                allTypeFilter.dataset.filterType = 'all';
                allTypeFilter.addEventListener('click', () => {
                    typeFilters.querySelectorAll('.filter-tag').forEach(tag => tag.classList.remove('active'));
                    allTypeFilter.classList.add('active');
                    activeFilters.type = 'all';
                    applyFilters();
                });
                typeFilters.appendChild(allTypeFilter);
                
                // Add type filters
                Array.from(allTypes).sort().forEach(type => {
                    const tag = document.createElement('span');
                    tag.className = 'filter-tag';
                    tag.textContent = type;
                    tag.dataset.filterType = type;
                    tag.addEventListener('click', () => {
                        typeFilters.querySelectorAll('.filter-tag').forEach(t => {
                            if (t.dataset.filterType === 'all') t.classList.remove('active');
                        });
                        tag.classList.toggle('active');
                        
                        if (tag.classList.contains('active')) {
                            activeFilters.type = type;
                        } else {
                            activeFilters.type = 'all';
                            allTypeFilter.classList.add('active');
                        }
                        applyFilters();
                    });
                    typeFilters.appendChild(tag);
                });
                
                // Add tag filters (most popular first)
                const popularTags = Array.from(allTags);
                popularTags.forEach(tagText => {
                    const tag = document.createElement('span');
                    tag.className = 'filter-tag';
                    tag.textContent = tagText;
                    tag.dataset.filterTag = tagText;
                    tag.addEventListener('click', () => {
                        tag.classList.toggle('active');
                        
                        if (tag.classList.contains('active')) {
                            activeFilters.tags.add(tagText);
                        } else {
                            activeFilters.tags.delete(tagText);
                        }
                        applyFilters();
                    });
                    tagFilters.appendChild(tag);
                });
            }
            
            // --- Filter Functions ---
            function applyViewFilter() {
                const bookmarks = JSON.parse(localStorage.getItem(STORAGE_KEYS.BOOKMARKS) || '[]');
                const likes = JSON.parse(localStorage.getItem(STORAGE_KEYS.LIKES) || '[]');
                const readingProgress = JSON.parse(localStorage.getItem(STORAGE_KEYS.READING_PROGRESS) || '{}');
                
                switch (currentView) {
                    case 'all':
                        displayedStories = [...allStories];
                        break;
                    case 'bookmarked':
                        displayedStories = allStories.filter(story => bookmarks.includes(story.id));
                        break;
                    case 'liked':
                        displayedStories = allStories.filter(story => likes.includes(story.id));
                        break;
                    case 'history':
                        const readingHistory = JSON.parse(localStorage.getItem(STORAGE_KEYS.READING_HISTORY) || '[]');
                        displayedStories = readingHistory
                            .map(id => allStories.find(story => story.id === id))
                            .filter(story => story);
                        break;
                }
                
                applyFilters();
            }
            
            function applyFilters() {
                clearTimeout(searchTimeout);
                
                searchTimeout = setTimeout(() => {
                    let filteredStories = displayedStories.filter(story => {
                        // Search filter
                        if (searchQuery) {
                            const searchLower = searchQuery.toLowerCase();
                            const inTitle = story.title?.toLowerCase().includes(searchLower) || false;
                            const inAuthor = story.author?.toLowerCase().includes(searchLower) || false;
                            const inDescription = story.description?.toLowerCase().includes(searchLower) || false;
                            const inType = story.type?.toLowerCase().includes(searchLower) || false;
                            const inTags = story.tags?.some(tag => tag.toLowerCase().includes(searchLower)) || false;
                            
                            if (!inTitle && !inAuthor && !inDescription && !inType && !inTags) {
                                return false;
                            }
                        }
                        
                        // Type filter
                        if (activeFilters.type !== 'all' && story.type !== activeFilters.type) {
                            return false;
                        }
                        
                        // Tag filter
                        if (activeFilters.tags.size > 0) {
                            if (!story.tags || !Array.isArray(story.tags)) return false;
                            
                            const hasTag = Array.from(activeFilters.tags).some(tag => 
                                story.tags.includes(tag)
                            );
                            
                            if (!hasTag) return false;
                        }
                        
                        return true;
                    });
                    
                    // Sort by relevance or progress
                    if (currentView === 'history') {
                        const readingHistory = JSON.parse(localStorage.getItem(STORAGE_KEYS.READING_HISTORY) || '[]');
                        filteredStories.sort((a, b) => {
                            const indexA = readingHistory.indexOf(a.id);
                            const indexB = readingHistory.indexOf(b.id);
                            return indexB - indexA; // Most recent first
                        });
                    } else {
                        // Sort by title for other views
                        filteredStories.sort((a, b) => a.title.localeCompare(b.title));
                    }
                    
                    displayedStories = filteredStories;
                    renderStories();
                    updateStats();
                }, 300); // Debounce search
            }
            
            // --- Story Rendering ---
            function renderStories() {
                storiesContainer.innerHTML = '';
                
                if (displayedStories.length === 0) {
                    const emptyState = document.createElement('div');
                    emptyState.className = 'empty-state';
                    emptyState.innerHTML = `
                        <i class="fas fa-book-open"></i>
                        <h3>No stories found</h3>
                        <p>Try adjusting your search or filters to find what you're looking for.</p>
                        <button class="reset-btn" onclick="resetFilters()">
                            <i class="fas fa-redo"></i> Reset Filters
                        </button>
                    `;
                    storiesContainer.appendChild(emptyState);
                    return;
                }
                
                displayedStories.forEach(story => {
                    const storyEl = createStoryCard(story);
                    storiesContainer.appendChild(storyEl);
                });
            }
            
            function createStoryCard(story) {
                const card = document.createElement('div');
                card.className = 'story-card';
                card.dataset.storyId = story.id;
                
                // User data
                const bookmarks = JSON.parse(localStorage.getItem(STORAGE_KEYS.BOOKMARKS) || '[]');
                const readingProgress = JSON.parse(localStorage.getItem(STORAGE_KEYS.READING_PROGRESS) || '{}');
                const likes = JSON.parse(localStorage.getItem(STORAGE_KEYS.LIKES) || '[]');
                
                const isBookmarked = bookmarks.includes(story.id);
                const isLiked = likes.includes(story.id);
                const progress = readingProgress[story.id]?.progress || 0;
                
                // Card image
                const image = document.createElement('div');
                image.className = 'story-card-image';
                image.style.backgroundImage = `url('${story.cover}')`;
                
                const overlay = document.createElement('div');
                overlay.className = 'story-card-overlay';
                
                if (story.tags && story.tags.length > 0) {
                    const tags = document.createElement('div');
                    tags.className = 'story-card-tags';
                    
                    story.tags.slice(0, 3).forEach(tag => {
                        const tagEl = document.createElement('span');
                        tagEl.className = 'story-card-tag';
                        tagEl.textContent = tag;
                        tags.appendChild(tagEl);
                    });
                    
                    overlay.appendChild(tags);
                }
                
                image.appendChild(overlay);
                
                // Card content
                const content = document.createElement('div');
                content.className = 'story-card-content';
                
                const header = document.createElement('div');
                header.className = 'story-card-header';
                
                const title = document.createElement('h3');
                title.className = 'story-card-title';
                title.textContent = story.title;
                
                const author = document.createElement('div');
                author.className = 'story-card-author';
                author.textContent = `by ${story.author}`;
                
                header.appendChild(title);
                header.appendChild(author);
                
                const meta = document.createElement('div');
                meta.className = 'story-card-meta';
                meta.innerHTML = `
                    <span class="story-card-type">${story.type}</span>
                    <span class="story-card-time">
                        <i class="far fa-clock"></i>
                        ${story.readTime} min
                    </span>
                `;
                
                const description = document.createElement('p');
                description.className = 'story-card-description';
                description.textContent = story.description;
                
                const footer = document.createElement('div');
                footer.className = 'story-card-footer';
                
                if (progress > 0) {
                    const progressBar = document.createElement('div');
                    progressBar.className = 'story-card-progress';
                    
                    const progressFill = document.createElement('div');
                    progressFill.className = 'story-card-progress-bar';
                    progressFill.style.width = `${progress}%`;
                    
                    progressBar.appendChild(progressFill);
                    footer.appendChild(progressBar);
                }
                
                const actions = document.createElement('div');
                actions.className = 'story-card-actions';
                
                const bookmarkBtn = document.createElement('button');
                bookmarkBtn.className = `story-card-btn ${isBookmarked ? 'active' : ''}`;
                bookmarkBtn.innerHTML = isBookmarked ? '<i class="fas fa-bookmark"></i>' : '<i class="far fa-bookmark"></i>';
                bookmarkBtn.title = isBookmarked ? 'Remove bookmark' : 'Bookmark story';
                bookmarkBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleBookmark(story.id);
                });
                
                const likeBtn = document.createElement('button');
                likeBtn.className = `story-card-btn ${isLiked ? 'active' : ''}`;
                likeBtn.innerHTML = isLiked ? '<i class="fas fa-heart"></i>' : '<i class="far fa-heart"></i>';
                likeBtn.title = isLiked ? 'Unlike story' : 'Like story';
                likeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleLike(story.id);
                });
                
                actions.appendChild(bookmarkBtn);
                actions.appendChild(likeBtn);
                footer.appendChild(actions);
                
                content.appendChild(header);
                content.appendChild(meta);
                content.appendChild(description);
                content.appendChild(footer);
                
                card.appendChild(image);
                card.appendChild(content);
                
                card.addEventListener('click', () => openStory(story));
                
                return card;
            }
            
            // --- Continue Reading Section ---
            function updateContinueReading() {
                continueReadingCards.innerHTML = '';
                
                const readingHistory = JSON.parse(localStorage.getItem(STORAGE_KEYS.READING_HISTORY) || '[]');
                const readingProgress = JSON.parse(localStorage.getItem(STORAGE_KEYS.READING_PROGRESS) || '{}');
                
                const recentReads = readingHistory
                    .map(storyId => {
                        const story = allStories.find(s => s.id === storyId);
                        const progress = readingProgress[storyId]?.progress || 0;
                        return story ? { ...story, progress } : null;
                    })
                    .filter(item => item !== null && item.progress > 0 && item.progress < 100)
                    .slice(0, 6);
                
                if (recentReads.length === 0) {
                    continueReadingSection.style.display = 'none';
                    return;
                }
                
                continueReadingSection.style.display = 'block';
                
                recentReads.forEach(story => {
                    const card = document.createElement('div');
                    card.className = 'continue-card';
                    card.dataset.storyId = story.id;
                    
                    const bg = document.createElement('div');
                    bg.className = 'continue-card-bg';
                    bg.style.backgroundImage = `url('${story.cover}')`;
                    
                    const content = document.createElement('div');
                    content.className = 'continue-card-content';
                    
                    const header = document.createElement('div');
                    header.className = 'continue-card-header';
                    
                    const title = document.createElement('div');
                    title.className = 'continue-card-title';
                    title.textContent = story.title;
                    
                    const closeBtn = document.createElement('button');
                    closeBtn.className = 'continue-card-close';
                    closeBtn.innerHTML = '<i class="fas fa-times"></i>';
                    closeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        removeFromContinueReading(story.id);
                    });
                    
                    header.appendChild(title);
                    header.appendChild(closeBtn);
                    
                    const progressBar = document.createElement('div');
                    progressBar.className = 'continue-card-progress';
                    
                    const progressFill = document.createElement('div');
                    progressFill.className = 'continue-card-progress-bar';
                    progressFill.style.width = `${story.progress}%`;
                    
                    progressBar.appendChild(progressFill);
                    
                    const meta = document.createElement('div');
                    meta.className = 'continue-card-meta';
                    meta.innerHTML = `
                        <span>${Math.round(story.progress)}% read</span>
                        <span>${story.readTime} min</span>
                    `;
                    
                    content.appendChild(header);
                    content.appendChild(progressBar);
                    content.appendChild(meta);
                    
                    card.appendChild(bg);
                    card.appendChild(content);
                    
                    card.addEventListener('click', () => {
                        openStory(story);
                        const page = readingProgress[story.id]?.page || 1;
                        currentPage = page;
                        renderStoryPage();
                    });
                    
                    continueReadingCards.appendChild(card);
                });
            }
            
            function removeFromContinueReading(storyId) {
                const readingHistory = JSON.parse(localStorage.getItem(STORAGE_KEYS.READING_HISTORY) || '[]');
                const newHistory = readingHistory.filter(id => id !== storyId);
                localStorage.setItem(STORAGE_KEYS.READING_HISTORY, JSON.stringify(newHistory));
                
                updateContinueReading();
                updateBadges();
                if (currentView === 'history') applyViewFilter();
                showToast('Removed from continue reading');
            }
            
            // --- User Actions ---
            function toggleBookmark(storyId) {
                const bookmarks = JSON.parse(localStorage.getItem(STORAGE_KEYS.BOOKMARKS) || '[]');
                const index = bookmarks.indexOf(storyId);
                
                if (index === -1) {
                    bookmarks.push(storyId);
                    showToast('Story bookmarked');
                } else {
                    bookmarks.splice(index, 1);
                    showToast('Bookmark removed');
                }
                
                localStorage.setItem(STORAGE_KEYS.BOOKMARKS, JSON.stringify(bookmarks));
                
                if (currentStoryData && currentStoryData.id === storyId) {
                    updateModalButtons(storyId);
                }
                
                if (currentView === 'bookmarked') {
                    applyViewFilter();
                } else {
                    renderStories();
                }
                
                updateStats();
                updateBadges();
            }
            
            function toggleLike(storyId) {
                const likes = JSON.parse(localStorage.getItem(STORAGE_KEYS.LIKES) || '[]');
                const index = likes.indexOf(storyId);
                
                if (index === -1) {
                    likes.push(storyId);
                    showToast('Story liked');
                } else {
                    likes.splice(index, 1);
                    showToast('Like removed');
                }
                
                localStorage.setItem(STORAGE_KEYS.LIKES, JSON.stringify(likes));
                
                if (currentStoryData && currentStoryData.id === storyId) {
                    updateModalButtons(storyId);
                }
                
                if (currentView === 'liked') {
                    applyViewFilter();
                } else {
                    renderStories();
                }
                
                updateStats();
                updateBadges();
            }
            
            function addToReadingHistory(storyId) {
                const readingHistory = JSON.parse(localStorage.getItem(STORAGE_KEYS.READING_HISTORY) || '[]');
                
                const index = readingHistory.indexOf(storyId);
                if (index !== -1) {
                    readingHistory.splice(index, 1);
                }
                
                readingHistory.unshift(storyId);
                
                if (readingHistory.length > 50) {
                    readingHistory.splice(50);
                }
                
                localStorage.setItem(STORAGE_KEYS.READING_HISTORY, JSON.stringify(readingHistory));
                
                updateContinueReading();
                updateBadges();
            }
            
            function saveReadingProgress(storyId, page, totalPages) {
                const readingProgress = JSON.parse(localStorage.getItem(STORAGE_KEYS.READING_PROGRESS) || '{}');
                const progress = Math.min(100, Math.round((page / totalPages) * 100));
                
                readingProgress[storyId] = {
                    progress,
                    page,
                    totalPages,
                    lastRead: Date.now()
                };
                
                localStorage.setItem(STORAGE_KEYS.READING_PROGRESS, JSON.stringify(readingProgress));
                
                updateContinueReading();
                updateStats();
            }
            
            // --- Story Modal ---
            async function openStory(story) {
                currentStoryData = story;
                modalTitle.textContent = story.title;
                modalStoryContent.innerHTML = '<div class="loading">Loading story...</div>';
                storyModal.classList.add('active');
                
                try {
                    currentStoryPages = paginateStory(story.content);
                    
                    const readingProgress = JSON.parse(localStorage.getItem(STORAGE_KEYS.READING_PROGRESS) || '{}');
                    currentPage = readingProgress[story.id]?.page || 1;
                    
                    renderStoryPage();
                    updateModalButtons(story.id);
                    
                    addToReadingHistory(story.id);
                    saveReadingProgress(story.id, currentPage, currentStoryPages.length);
                    
                } catch (err) {
                    console.error("Error loading story:", err);
                    modalStoryContent.innerHTML = '<div class="error">Error loading story. Please try again.</div>';
                }
            }
            
            function paginateStory(text) {
                const words = text.split(/\s+/);
                const pages = [];
                
                for (let i = 0; i < words.length; i += WORDS_PER_PAGE) {
                    const pageWords = words.slice(i, i + WORDS_PER_PAGE);
                    pages.push(pageWords.join(' '));
                }
                
                return pages.length > 0 ? pages : [text];
            }
            
            function renderStoryPage() {
                if (!currentStoryPages.length) return;
                
                const pageIndex = Math.min(Math.max(0, currentPage - 1), currentStoryPages.length - 1);
                let pageContent = currentStoryPages[pageIndex];
                
                // Basic markdown parsing
                pageContent = pageContent
                    .replace(/# (.*?)(\n|$)/g, '<h1>$1</h1>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/_(.*?)_/g, '<em>$1</em>')
                    .replace(/> (.*?)(\n|$)/g, '<blockquote>$1</blockquote>')
                    .replace(/\n/g, '<br>');
                
                modalStoryContent.innerHTML = pageContent;
                pageInput.value = currentPage;
                totalPagesEl.textContent = `/ ${currentStoryPages.length}`;
                
                prevPageBtn.disabled = currentPage <= 1;
                nextPageBtn.disabled = currentPage >= currentStoryPages.length;
                
                // Save progress
                if (currentStoryData) {
                    saveReadingProgress(currentStoryData.id, currentPage, currentStoryPages.length);
                }
            }
            
            function updateModalButtons(storyId) {
                const bookmarks = JSON.parse(localStorage.getItem(STORAGE_KEYS.BOOKMARKS) || '[]');
                const likes = JSON.parse(localStorage.getItem(STORAGE_KEYS.LIKES) || '[]');
                
                const isBookmarked = bookmarks.includes(storyId);
                const isLiked = likes.includes(storyId);
                
                modalBookmarkBtn.innerHTML = isBookmarked ? 
                    '<i class="fas fa-bookmark"></i>' : '<i class="far fa-bookmark"></i>';
                modalBookmarkBtn.title = isBookmarked ? 'Remove bookmark' : 'Bookmark story';
                modalBookmarkBtn.classList.toggle('active', isBookmarked);
                
                modalLikeBtn.innerHTML = isLiked ? 
                    '<i class="fas fa-heart"></i>' : '<i class="far fa-heart"></i>';
                modalLikeBtn.title = isLiked ? 'Unlike story' : 'Like story';
                modalLikeBtn.classList.toggle('active', isLiked);
            }
            
            // --- Audio Controls ---
            function toggleSound(soundId) {
                const options = document.querySelectorAll('.audio-option');
                
                if (activeSound === soundId) {
                    audioElements[soundId].pause();
                    activeSound = null;
                    localStorage.removeItem(STORAGE_KEYS.SOUND);
                    
                    options.forEach(option => option.classList.remove('active'));
                    showToast('Sound stopped');
                } else {
                    if (activeSound && audioElements[activeSound]) {
                        audioElements[activeSound].pause();
                    }
                    
                    audioElements[soundId].play().catch(err => {
                        console.error("Audio play failed:", err);
                        showToast('Could not play sound');
                    });
                    
                    activeSound = soundId;
                    localStorage.setItem(STORAGE_KEYS.SOUND, soundId);
                    
                    options.forEach(option => {
                        option.classList.remove('active');
                        if (option.dataset.soundId === soundId) {
                            option.classList.add('active');
                        }
                    });
                    
                    const soundName = SOUNDS.find(s => s.id === soundId)?.name || 'Sound';
                    showToast(`Playing: ${soundName}`);
                }
            }
            
            function updateVolume(soundId, volume) {
                if (audioElements[soundId]) {
                    audioElements[soundId].volume = volume;
                    if (activeSound === soundId) {
                        localStorage.setItem(STORAGE_KEYS.VOLUME, volume);
                    }
                }
            }
            
            // --- UI Update Functions ---
            function updateStats() {
                totalStoriesEl.textContent = displayedStories.length;
                
                const bookmarks = JSON.parse(localStorage.getItem(STORAGE_KEYS.BOOKMARKS) || '[]');
                bookmarkedCountEl.textContent = bookmarks.length;
                
                const likes = JSON.parse(localStorage.getItem(STORAGE_KEYS.LIKES) || '[]');
                likedCountEl.textContent = likes.length;
                
                const readingProgress = JSON.parse(localStorage.getItem(STORAGE_KEYS.READING_PROGRESS) || '{}');
                const totalReadTime = Object.keys(readingProgress).reduce((total, storyId) => {
                    const story = allStories.find(s => s.id === storyId);
                    return total + (story?.readTime || 0);
                }, 0);
                
                totalReadTimeEl.textContent = totalReadTime;
            }
            
            function updateBadges() {
                const bookmarks = JSON.parse(localStorage.getItem(STORAGE_KEYS.BOOKMARKS) || '[]');
                const likes = JSON.parse(localStorage.getItem(STORAGE_KEYS.LIKES) || '[]');
                const readingHistory = JSON.parse(localStorage.getItem(STORAGE_KEYS.READING_HISTORY) || '[]');
                
                bookmarkBadge.textContent = bookmarks.length;
                likeBadge.textContent = likes.length;
                historyBadge.textContent = readingHistory.length;
            }
            
            function showToast(message) {
                toastMessage.textContent = message;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
            
            function resetFilters() {
                // Reset search
                searchInput.value = '';
                searchQuery = '';
                
                // Reset filter tags
                document.querySelectorAll('.filter-tag').forEach(tag => {
                    tag.classList.remove('active');
                    if (tag.dataset.filterType === 'all') {
                        tag.classList.add('active');
                    }
                });
                
                // Reset active filters
                activeFilters = {
                    type: 'all',
                    tags: new Set()
                };
                
                // Reset to all view
                currentView = 'all';
                
                // Apply filters
                applyViewFilter();
                
                // Close filter panel if open
                filterPanel.classList.remove('active');
                filterToggle.classList.remove('active');
                
                showToast('Filters reset');
            }
            
            // --- Event Listeners ---
            function initEventListeners() {
                // Theme toggle
                themeToggle.addEventListener('click', () => {
                    const isDark = document.body.classList.contains('dark-mode');
                    
                    if (isDark) {
                        document.body.classList.remove('dark-mode');
                        themeToggle.innerHTML = '<i class="fas fa-sun"></i><span class="tooltip">Light Mode</span>';
                        themeToggle.classList.add('active');
                        localStorage.setItem(STORAGE_KEYS.THEME, 'light');
                        showToast('Switched to light mode');
                    } else {
                        document.body.classList.add('dark-mode');
                        themeToggle.innerHTML = '<i class="fas fa-moon"></i><span class="tooltip">Dark Mode</span>';
                        themeToggle.classList.remove('active');
                        localStorage.setItem(STORAGE_KEYS.THEME, 'dark');
                        showToast('Switched to dark mode');
                    }
                });
                
                // Search with debouncing and auto-reset
                searchInput.addEventListener('input', (e) => {
                    searchQuery = e.target.value.trim();
                    
                    // Auto-reset filters when search is empty
                    if (!searchQuery) {
                        resetFilters();
                    } else {
                        applyFilters();
                    }
                });
                
                // Filter panel
                filterToggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    filterPanel.classList.toggle('active');
                    filterToggle.classList.toggle('active');
                });
                
                // Close filter panel when clicking outside
                document.addEventListener('click', (e) => {
                    if (!filterToggle.contains(e.target) && !filterPanel.contains(e.target)) {
                        filterPanel.classList.remove('active');
                        filterToggle.classList.remove('active');
                    }
                });
                
                // Audio dialog
                audioToggle.addEventListener('click', () => {
                    audioDialog.classList.toggle('active');
                });
                
                closeAudioDialog.addEventListener('click', () => {
                    audioDialog.classList.remove('active');
                });
                
                audioDialog.addEventListener('click', (e) => {
                    if (e.target === audioDialog) {
                        audioDialog.classList.remove('active');
                    }
                });
                
                // Modal controls
                closeModal.addEventListener('click', () => {
                    storyModal.classList.remove('active');
                    currentStoryData = null;
                    currentStoryPages = [];
                });
                
                prevPageBtn.addEventListener('click', () => {
                    if (currentPage > 1) {
                        currentPage--;
                        renderStoryPage();
                    }
                });
                
                nextPageBtn.addEventListener('click', () => {
                    if (currentPage < currentStoryPages.length) {
                        currentPage++;
                        renderStoryPage();
                    }
                });
                
                pageInput.addEventListener('change', () => {
                    const newPage = parseInt(pageInput.value);
                    if (!isNaN(newPage) && newPage >= 1 && newPage <= currentStoryPages.length) {
                        currentPage = newPage;
                        renderStoryPage();
                    } else {
                        pageInput.value = currentPage;
                    }
                });
                
                modalBookmarkBtn.addEventListener('click', () => {
                    if (currentStoryData) {
                        toggleBookmark(currentStoryData.id);
                    }
                });
                
                modalLikeBtn.addEventListener('click', () => {
                    if (currentStoryData) {
                        toggleLike(currentStoryData.id);
                    }
                });
                
                // FAB menu
                fabMain.addEventListener('click', () => {
                    fabMenu.classList.toggle('active');
                    fabMain.classList.toggle('active');
                });
                
                fabBookmarks.addEventListener('click', () => {
                    currentView = 'bookmarked';
                    fabMenu.classList.remove('active');
                    fabMain.classList.remove('active');
                    applyViewFilter();
                    showToast('Showing bookmarked stories');
                });
                
                fabLikes.addEventListener('click', () => {
                    currentView = 'liked';
                    fabMenu.classList.remove('active');
                    fabMain.classList.remove('active');
                    applyViewFilter();
                    showToast('Showing liked stories');
                });
                
                fabHistory.addEventListener('click', () => {
                    currentView = 'history';
                    fabMenu.classList.remove('active');
                    fabMain.classList.remove('active');
                    applyViewFilter();
                    showToast('Showing reading history');
                });
                
                // Close modals on background click
                storyModal.addEventListener('click', (e) => {
                    if (e.target === storyModal) {
                        storyModal.classList.remove('active');
                        currentStoryData = null;
                        currentStoryPages = [];
                    }
                });
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        if (storyModal.classList.contains('active')) {
                            storyModal.classList.remove('active');
                            currentStoryData = null;
                            currentStoryPages = [];
                        }
                        if (audioDialog.classList.contains('active')) {
                            audioDialog.classList.remove('active');
                        }
                        if (filterPanel.classList.contains('active')) {
                            filterPanel.classList.remove('active');
                            filterToggle.classList.remove('active');
                        }
                        fabMenu.classList.remove('active');
                        fabMain.classList.remove('active');
                    }
                    
                    if (storyModal.classList.contains('active')) {
                        if (e.key === 'ArrowLeft') {
                            e.preventDefault();
                            prevPageBtn.click();
                        } else if (e.key === 'ArrowRight') {
                            e.preventDefault();
                            nextPageBtn.click();
                        } else if (e.key === 'b' && (e.ctrlKey || e.metaKey)) {
                            e.preventDefault();
                            modalBookmarkBtn.click();
                        } else if (e.key === 'l' && (e.ctrlKey || e.metaKey)) {
                            e.preventDefault();
                            modalLikeBtn.click();
                        }
                    }
                    
                    // Space to pause/play audio
                    if (e.key === ' ' && activeSound && !e.target.matches('input, textarea, button')) {
                        e.preventDefault();
                        toggleSound(activeSound);
                    }
                });
                
                // Reset filters button (for empty state)
                window.resetFilters = resetFilters;
            }
            
            // Start the application
            init();
        });
    </script>
</body>
</html>
