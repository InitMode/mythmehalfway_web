<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MythMeHalfway </title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react"></script>
    
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        .line-clamp-2 { overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 2; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    
    <script type="text/babel" data-type="module">
        // Import React hooks (they're available globally from CDN)
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Configuration ---
       // --- Configuration ---
const GITHUB_API_CONFIG = {
    // API endpoints (using GitHub Pages API)
    apiBaseUrl: '', // Leave empty for same-origin requests (GitHub Pages)
    // CORRECTED: Ensure the index path includes /api/
    statusEndpoint: '/api/status.json',
    storiesIndexEndpoint: '/api/stories/index.json', // FIX: Added '/api/' prefix back
};

// ...
// FIX: You also need to correct the individual story fetch path (Line 89)
const storiesPromises = storiesIndex.map(async (storyFile) => {
    try {
        // FIX: Added '/api/' prefix here
       const storyResponse = await fetch(`${GITHUB_API_CONFIG.apiBaseUrl}/api/stories/${storyFile}`);
        // ...

        // --- Sounds ---
        const SOUNDS = [
            { id: 'rain', name: 'Heavy Rain', url: 'https://actions.google.com/sounds/v1/weather/rain_heavy_loud.ogg' },
            { id: 'fire', name: 'Campfire', url: 'https://actions.google.com/sounds/v1/ambiences/fire.ogg' },
            { id: 'coffee', name: 'Coffee Shop', url: 'https://actions.google.com/sounds/v1/ambiences/coffee_shop.ogg' },
            { id: 'forest', name: 'Forest', url: 'https://actions.google.com/sounds/v1/nature/forest_wind.ogg' }
        ];

        // --- Helper Functions ---
        const parseMarkdownFrontmatter = (content) => {
            const lines = content.split('\n');
            const frontmatter = {};
            let inFrontmatter = false;
            let contentStart = 0;
            
            if (lines[0] === '---') {
                inFrontmatter = true;
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i] === '---') {
                        inFrontmatter = false;
                        contentStart = i + 1;
                        break;
                    }
                    const match = lines[i].match(/^(\w+):\s*(.+)$/);
                    if (match) {
                        const [, key, value] = match;
                        frontmatter[key.trim()] = value.trim().replace(/^["']|["']$/g, '');
                    }
                }
            }
            
            const storyContent = lines.slice(contentStart).join('\n').trim();
            return { frontmatter, content: storyContent };
        };

        const estimateReadTime = (text) => {
            const wordsPerMinute = 200;
            const wordCount = text.split(/\s+/).length;
            return Math.max(1, Math.ceil(wordCount / wordsPerMinute));
        };

        // --- Data Fetching Functions ---
        const fetchStoriesFromAPI = async () => {
            try {
                // First check if API is running
                const statusResponse = await fetch(`${GITHUB_API_CONFIG.apiBaseUrl}${GITHUB_API_CONFIG.statusEndpoint}`);
                if (!statusResponse.ok) throw new Error('API not available');
                
                // Fetch stories index
                const storiesResponse = await fetch(`${GITHUB_API_CONFIG.apiBaseUrl}${GITHUB_API_CONFIG.storiesIndexEndpoint}`);
                if (!storiesResponse.ok) throw new Error('Failed to fetch stories index');
                
                const storiesIndex = await storiesResponse.json();
                
                // Load each story
                const storiesPromises = storiesIndex.map(async (storyFile) => {
                    try {
                        const storyResponse = await fetch(`${GITHUB_API_CONFIG.apiBaseUrl}/stories/${storyFile}`);
                        if (!storyResponse.ok) throw new Error(`Failed to fetch ${storyFile}`);
                        
                        const markdown = await storyResponse.text();
                        const { frontmatter, content } = parseMarkdownFrontmatter(markdown);
                        
                        return {
                            id: storyFile.replace('.md', '').replace('story', ''),
                            title: frontmatter.title || 'Untitled Story',
                            author: frontmatter.author || 'Unknown Author',
                            category: frontmatter.type?.charAt(0).toUpperCase() + frontmatter.type?.slice(1) || 'Fiction',
                            cover: frontmatter.cover || `https://source.unsplash.com/featured/?story,${frontmatter.tags?.[0] || 'africa'}`,
                            description: frontmatter.description || 'A captivating story from the collection.',
                            content: content,
                            readTimeMin: estimateReadTime(content),
                            likes: Math.floor(Math.random() * 200) + 50,
                            views: Math.floor(Math.random() * 1000) + 100,
                            tags: frontmatter.tags ? frontmatter.tags.split(',').map(tag => tag.trim()) : []
                        };
                    } catch (error) {
                        console.error(`Error loading story ${storyFile}:`, error);
                        return null;
                    }
                });
                
                const stories = (await Promise.all(storiesPromises)).filter(story => story !== null);
                return stories;
                
            } catch (error) {
                console.error('Error fetching from API:', error);
                throw error;
            }
        };

        // Fallback to initial dummy data
        const getFallbackStories = () => {
            const generateDummyContent = (title) => {
                const paragraphs = [
                    `The sun hung low over the horizon, casting long shadows across the ${title.toLowerCase()}. It was a time of great change, whispered the elders, though the youth paid them no mind.`,
                    "Silence wrapped around the room like a heavy blanket. In the distance, a clock chimed, marking the passage of hours that felt like mere seconds.",
                    "Why do we seek the halfway point? It is neither here nor there, a purgatory of indecision. Yet, in this story, the middle ground is where the magic happens.",
                    "She turned the page, her fingers trembling slightly. The ink seemed to shimmer, rearranging itself into words that were meant only for her eyes.",
                    "The journey was far from over. Mountains loomed ahead, their peaks piercing the clouds, promising both danger and salvation to those brave enough to climb.",
                    "Technology hummed in the background, a constant reminder of the world they had left behind. But here, in the quiet, analog thoughts reigned supreme.",
                    "It wasn't just about the destination. It was about the people met along the way, the scars earned, and the stories that would be told for generations."
                ];
                return [...paragraphs, ...paragraphs, ...paragraphs].join('\n\n');
            };

            return [
                {
                    id: '1',
                    title: "The Girl Who Borrowed the Wind",
                    author: "Salt Merchant",
                    category: "Fiction",
                    cover: "https://source.unsplash.com/featured/?baobab,wind",
                    description: "A short magical tale from Ukambani about courage, sacrifice, and the Wind Spirit Mwenga Mkuu.",
                    content: `# The Girl Who Borrowed the Wind

In the drought-stricken plains of Ukambani, there lived a young girl named Mumo.  
Her village had not felt a breeze in many moons, and the wells were turning into dust.

One evening, Mumo wandered to the sacred hill where the old stories say the **Wind Spirit**,  
_Mwenga Mkuu_, sleeps inside a giant baobab tree.  
Most children feared the placeâ€”but Mumo was brave.

She placed her palms on the rough bark.

> "Great Mwenga," she whispered.  
> "My people grow weak. Please, wake, even for a moment."

The baobab groaned.  
A cool swirl of air wrapped around her wrists like bracelets of morning mist.

The Wind Spirit spoke:

> "Child of courage, I can lend you a breeze.  
> But when I give, something must be returned."

Mumo thought hard. She had no water.  
She had no cattle.  
But she had her voice.

So she offered it.

> "Take my songs, Mwenga.  
> My voice carries stories, and stories are part of the wind."

The spirit agreed.  
A powerful gust spiraled into her hands, glowing like soft blue fire.

Mumo ran home, releasing the wind across the dry fields.  
Clouds gathered, rain fell, children danced.

But Mumo could no longer sing.

Weeks later, the Wind Spirit returned, moved by her sacrifice.  
It placed a warm breeze in her throat.

> "Your songs are now part of every wind," it said.  
> "Each time the breeze touches your village, it brings your voice home."

And so the people of Ukambani say that when the wind hums through the baobab trees,  
you can hear a soft girl's songâ€”  
a reminder of Mumo, who borrowed the wind to save her people.`,
                    readTimeMin: 3,
                    likes: 124,
                    views: 1050,
                    tags: ["African mythology", "Kenyan folklore", "magical realism", "short story"]
                },
                {
                    id: '2',
                    title: "Digital Gardens",
                    author: "Marcus Chen",
                    category: "Blog",
                    cover: "https://images.unsplash.com/photo-1550684848-fac1c5b4e853?auto=format&fit=crop&q=80&w=600",
                    description: "Why tending to your personal notes is better than social media.",
                    content: generateDummyContent("Digital Gardens"),
                    readTimeMin: 3,
                    likes: 89,
                    views: 520,
                    tags: ["technology", "blog", "personal growth"]
                },
                {
                    id: '3',
                    title: "Echoes of History",
                    author: "Sarah J. Miller",
                    category: "Non-Fiction",
                    cover: "https://images.unsplash.com/photo-1461360370896-922624d12aa1?auto=format&fit=crop&q=80&w=600",
                    description: "Understanding the patterns of the past to predict the future.",
                    content: generateDummyContent("Echoes of History"),
                    readTimeMin: 8,
                    likes: 450,
                    views: 2300,
                    tags: ["history", "non-fiction", "analysis"]
                },
                {
                    id: '4',
                    title: "Neon Nights",
                    author: "J.D. Salinger-Bot",
                    category: "Fiction",
                    cover: "https://images.unsplash.com/photo-1555680202-c86f0e12f086?auto=format&fit=crop&q=80&w=600",
                    description: "Cyberpunk detective stories from a city that never sleeps.",
                    content: generateDummyContent("Neon Nights"),
                    readTimeMin: 6,
                    likes: 210,
                    views: 890,
                    tags: ["cyberpunk", "fiction", "detective"]
                }
            ];
        };

        // --- Sub-Components ---

        const Notification = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };

            return React.createElement('div', {
                className: `fixed top-20 right-4 ${colors[type] || colors.info} text-white px-6 py-3 rounded-lg shadow-lg z-[100] animate-fade-in flex items-center gap-2`
            },
                React.createElement('span', null, message),
                React.createElement('button', {
                    onClick: onClose,
                    className: "ml-2 hover:text-gray-200"
                }, 'âœ•')
            );
        };

        const Modal = ({ isOpen, onClose, title, children, isDark }) => {
            if (!isOpen) return null;
            
            return React.createElement('div', {
                className: "fixed inset-0 z-[70] flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm p-4"
            },
                React.createElement('div', {
                    className: `${isDark ? 'bg-gray-800 text-white' : 'bg-white text-gray-900'} rounded-xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto animate-fade-in`
                },
                    React.createElement('div', {
                        className: `flex justify-between items-center p-6 border-b ${isDark ? 'border-gray-700 bg-gray-800' : 'border-gray-100 bg-white'} sticky top-0`
                    },
                        React.createElement('h2', { className: "text-xl font-bold" }, title),
                        React.createElement('button', {
                            onClick: onClose,
                            className: `p-2 rounded-full transition ${isDark ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`
                        }, 'âœ•')
                    ),
                    React.createElement('div', { className: "p-6" }, children)
                )
            );
        };

        const BookCard = ({ book, onRead, isBookmarked, onToggleBookmark, onLike, likes, isDark }) => {
            return React.createElement('div', {
                className: `${isDark ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-100'} rounded-xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden group border flex flex-col h-full animate-fade-in`
            },
                React.createElement('div', {
                    className: "relative h-48 overflow-hidden cursor-pointer",
                    onClick: () => onRead(book)
                },
                    React.createElement('img', {
                        src: book.cover,
                        alt: book.title,
                        className: "w-full h-full object-cover transition transform group-hover:scale-105 duration-500"
                    }),
                    React.createElement('div', { className: "absolute top-3 right-3 flex gap-2" },
                        React.createElement('button', {
                            onClick: (e) => { e.stopPropagation(); onToggleBookmark(book.id); },
                            className: `p-2 rounded-full backdrop-blur-md transition shadow-sm ${
                                isBookmarked 
                                ? 'bg-yellow-400 text-white' 
                                : 'bg-white/90 text-gray-600 hover:bg-white'
                            }`
                        }, 'ðŸ”–')
                    ),
                    React.createElement('div', { className: "absolute bottom-3 left-3" },
                        React.createElement('span', {
                            className: "px-2 py-1 text-xs font-semibold bg-black/70 text-white rounded-md backdrop-blur-sm"
                        }, book.category)
                    )
                ),
                React.createElement('div', { className: "p-5 flex-1 flex flex-col" },
                    React.createElement('h3', {
                        className: `font-bold text-lg leading-tight mb-1 cursor-pointer hover:text-indigo-500 transition ${isDark ? 'text-white' : 'text-gray-800'}`,
                        onClick: () => onRead(book)
                    }, book.title),
                    React.createElement('p', {
                        className: `text-sm mb-4 ${isDark ? 'text-gray-400' : 'text-gray-500'}`
                    }, `by ${book.author}`),
                    React.createElement('p', {
                        className: `text-sm line-clamp-2 mb-4 flex-1 ${isDark ? 'text-gray-300' : 'text-gray-600'}`
                    }, book.description),
                    React.createElement('div', {
                        className: `flex items-center justify-between mt-auto pt-4 border-t ${isDark ? 'border-gray-700' : 'border-gray-50'}`
                    },
                        React.createElement('div', {
                            className: `flex items-center gap-4 text-xs ${isDark ? 'text-gray-400' : 'text-gray-500'}`
                        },
                            React.createElement('span', { className: "flex items-center gap-1" }, 'â±ï¸ ', book.readTimeMin, ' min'),
                            React.createElement('button', {
                                onClick: (e) => {e.stopPropagation(); onLike(book.id)},
                                className: "flex items-center gap-1 hover:text-red-500 transition"
                            },
                                'â¤ï¸ ',
                                likes[book.id] || book.likes
                            )
                        ),
                        React.createElement('button', {
                            onClick: () => onRead(book),
                            className: "px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 transition shadow-md hover:shadow-lg"
                        }, 'Read')
                    )
                )
            );
        };

        const SoundWidget = ({ activeSound, onToggleSound, isDark }) => {
            const [isOpen, setIsOpen] = useState(false);
            const audioRef = useRef(null);

            useEffect(() => {
                if (activeSound) {
                    if (audioRef.current) {
                        audioRef.current.src = activeSound.url;
                        audioRef.current.play().catch(e => console.log("Audio play failed:", e));
                    }
                } else {
                    if (audioRef.current) {
                        audioRef.current.pause();
                        audioRef.current.src = "";
                    }
                }
            }, [activeSound]);

            return React.createElement('div', { className: "fixed bottom-24 right-6 z-50 flex flex-col items-end gap-2" },
                React.createElement('audio', { ref: audioRef, loop: true }),
                
                isOpen && React.createElement('div', {
                    className: `mb-2 p-2 rounded-lg shadow-xl border ${isDark ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-100'} animate-fade-in flex flex-col gap-1 w-48`
                },
                    React.createElement('div', {
                        className: `text-xs font-bold uppercase tracking-wider px-2 py-1 ${isDark ? 'text-gray-400' : 'text-gray-500'}`
                    }, 'Background Sounds'),
                    SOUNDS.map(sound => 
                        React.createElement('button', {
                            key: sound.id,
                            onClick: () => onToggleSound(sound),
                            className: `w-full text-left px-3 py-2 rounded-md text-sm transition flex items-center justify-between
                                ${activeSound?.id === sound.id 
                                    ? 'bg-indigo-100 text-indigo-700 font-semibold' 
                                    : isDark ? 'text-gray-300 hover:bg-gray-700' : 'text-gray-700 hover:bg-gray-50'
                                }`
                        },
                            React.createElement('span', null, sound.name),
                            activeSound?.id === sound.id && 'ðŸ”Š'
                        )
                    ),
                    activeSound && React.createElement('button', {
                        onClick: () => onToggleSound(null),
                        className: "text-xs text-red-500 hover:text-red-600 mt-2 px-2 py-1 text-right w-full font-medium"
                    }, 'Stop Audio')
                ),
                React.createElement('button', {
                    onClick: () => setIsOpen(!isOpen),
                    className: `p-4 rounded-full shadow-lg transition transform hover:scale-105 ${
                        activeSound 
                        ? 'bg-indigo-600 text-white ring-4 ring-indigo-200' 
                        : isDark ? 'bg-gray-800 text-indigo-400 border border-gray-700' : 'bg-white text-indigo-600 border border-gray-200'
                    }`,
                    title: "Background Sounds"
                }, activeSound ? 'â¸ï¸' : 'ðŸŽµ')
            );
        };

        const ContinueReadingCard = ({ book, progress, onResume, isDark }) => {
            return React.createElement('div', {
                className: `mb-8 p-4 rounded-xl border-l-4 border-indigo-500 shadow-md flex flex-col sm:flex-row justify-between items-start sm:items-center ${isDark ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-100'}`
            },
                React.createElement('div', { className: "flex items-center gap-4 flex-1 w-full sm:w-auto mb-3 sm:mb-0" },
                    'ðŸ”„',
                    React.createElement('div', null,
                        React.createElement('h3', {
                            className: `font-semibold text-lg ${isDark ? 'text-white' : 'text-gray-800'}`
                        }, 'Continue Reading'),
                        React.createElement('p', {
                            className: `text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}`
                        }, `${book.title} by ${book.author}`)
                    )
                ),
                React.createElement('div', { className: "flex items-center gap-4 w-full sm:w-auto" },
                    React.createElement('div', { className: "w-28 h-2 bg-gray-300/50 rounded-full overflow-hidden" },
                        React.createElement('div', {
                            className: "h-full bg-indigo-500",
                            style: { width: `${progress}%` }
                        })
                    ),
                    React.createElement('span', {
                        className: `text-sm font-medium ${isDark ? 'text-indigo-300' : 'text-indigo-600'}`
                    }, `${Math.floor(progress)}%`),
                    React.createElement('button', {
                        onClick: onResume,
                        className: "flex items-center gap-1 px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 transition shadow-md"
                    }, 'Resume â†’')
                )
            );
        };

        const LoadingSpinner = ({ isDark }) => {
            return React.createElement('div', {
                className: "flex flex-col items-center justify-center min-h-[60vh] gap-4"
            },
                React.createElement('div', {
                    className: `w-16 h-16 border-4 border-t-indigo-600 border-r-transparent border-b-indigo-600 border-l-transparent rounded-full animate-spin`
                }),
                React.createElement('p', {
                    className: `${isDark ? 'text-gray-400' : 'text-gray-600'} font-medium`
                }, "Loading stories...")
            );
        };

        const LibraryView = ({ 
            books, readingStats, bookmarks, likes, 
            onRead, onToggleBookmark, onLike, 
            setShowAddBook, setShowBookmarks, isDark,
            lastReadPosition, onResumeReading,
            isLoading
        }) => {
            const lastReadBook = books.find(b => b.id === lastReadPosition.bookId);
            const shouldShowContinueReading = lastReadBook && lastReadPosition.progress > 5 && lastReadPosition.progress < 95;

            if (isLoading) {
                return React.createElement('div', { className: "container mx-auto px-4 py-8 max-w-7xl animate-fade-in pb-32" },
                    React.createElement(LoadingSpinner, { isDark: isDark })
                );
            }

            return React.createElement('div', { className: "container mx-auto px-4 py-8 max-w-7xl animate-fade-in pb-32" },
                React.createElement('div', { className: "flex flex-col md:flex-row justify-between items-center mb-10 gap-4" },
                    React.createElement('div', null,
                        React.createElement('h1', {
                            className: `text-4xl font-black tracking-tight mb-2 ${isDark ? 'text-white' : 'text-gray-900'}`
                        }, 'MythMeHalfway'),
                        React.createElement('p', {
                            className: `${isDark ? 'text-gray-400' : 'text-gray-500'}`
                        }, 'Curated stories, infinite imaginations.')
                    ),
                    React.createElement('div', { className: "flex gap-4" },
                        React.createElement('div', {
                            className: `px-4 py-2 rounded-lg shadow-sm border flex items-center gap-2 ${isDark ? 'bg-gray-800 border-gray-700 text-gray-200' : 'bg-white border-gray-100 text-gray-700'}`
                        }, 'â±ï¸', React.createElement('span', { className: "font-bold" }, Math.floor(readingStats.totalMinutes), ' mins')),
                        React.createElement('div', {
                            className: `px-4 py-2 rounded-lg shadow-sm border flex items-center gap-2 ${isDark ? 'bg-gray-800 border-gray-700 text-gray-200' : 'bg-white border-gray-100 text-gray-700'}`
                        }, 'ðŸ“–', React.createElement('span', { className: "font-bold" }, readingStats.booksRead, ' read')),
                        React.createElement('div', {
                            className: `px-4 py-2 rounded-lg shadow-sm border flex items-center gap-2 ${isDark ? 'bg-gray-800 border-gray-700 text-gray-200' : 'bg-white border-gray-100 text-gray-700'}`
                        }, 'ðŸ“š', React.createElement('span', { className: "font-bold" }, books.length, ' stories'))
                    )
                ),
                
                shouldShowContinueReading && React.createElement(ContinueReadingCard, {
                    book: lastReadBook,
                    progress: lastReadPosition.progress,
                    onResume: onResumeReading,
                    isDark: isDark
                }),

                books.length === 0 ? 
                    React.createElement('div', {
                        className: `text-center py-20 ${isDark ? 'text-gray-400' : 'text-gray-600'}`
                    },
                        'ðŸ“–',
                        React.createElement('p', { className: "text-xl font-medium mb-2" }, "No stories found"),
                        React.createElement('p', { className: "text-sm" }, "Try refreshing the page or check your connection")
                    ) :
                    React.createElement('div', { className: "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" },
                        books.map(book => 
                            React.createElement(BookCard, {
                                key: book.id,
                                book: book,
                                onRead: onRead,
                                isBookmarked: bookmarks.includes(book.id),
                                onToggleBookmark: onToggleBookmark,
                                onLike: onLike,
                                likes: likes,
                                isDark: isDark
                            })
                        )
                    ),

                React.createElement('div', { className: "fixed bottom-6 right-6 flex flex-col gap-3 z-30" },
                    React.createElement('button', {
                        onClick: () => setShowAddBook(true),
                        className: "bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-full shadow-lg transition transform hover:scale-110",
                        title: "Add Book"
                    }, 'âž•')
                ),

                React.createElement('div', { className: "fixed bottom-6 left-6 z-30" },
                    React.createElement('button', {
                        onClick: () => setShowBookmarks(true),
                        className: `p-4 rounded-full shadow-lg border transition transform hover:scale-110 ${isDark ? 'bg-gray-800 text-indigo-400 border-gray-700 hover:bg-gray-700' : 'bg-white text-indigo-600 border-gray-200 hover:bg-gray-50'}`,
                        title: "View Bookmarks"
                    }, 'ðŸ”–')
                )
            );
        };

        const ReaderView = ({ 
            book, books, onClose, isDark, 
            bookmarks, likes, onToggleBookmark, onLike, onRead, 
            onUpdateProgress
        }) => {
            const [fontSize, setFontSize] = useState(18);
            const [progress, setProgress] = useState(0);
            const contentRef = useRef(null);

            const relatedBooks = useMemo(() => {
                let related = books.filter(b => b.id !== book.id && b.category === book.category);
                
                if (related.length < 3) {
                    const newest = books
                        .filter(b => b.id !== book.id && b.category !== book.category && !related.find(r => r.id === b.id))
                        .sort((a, b) => b.id - a.id);
                    related = [...related, ...newest];
                }

                return related.slice(0, 3);
            }, [book, books]);

            useEffect(() => {
                if (contentRef.current) {
                    const initialProgress = book.initialScrollProgress || 0;
                    const { scrollHeight, clientHeight } = contentRef.current;
                    const maxScroll = scrollHeight - clientHeight;
                    const targetScroll = (maxScroll * initialProgress) / 100;
                    
                    contentRef.current.scrollTo({ 
                        top: targetScroll, 
                        behavior: initialProgress > 0 ? 'smooth' : 'auto' 
                    });

                    setProgress(initialProgress);
                }
            }, [book.id, book.initialScrollProgress]);

            const handleScroll = (e) => {
                const { scrollTop, scrollHeight, clientHeight } = e.target;
                const maxScroll = scrollHeight - clientHeight;
                
                if (maxScroll <= 0) return;

                const percentage = (scrollTop / maxScroll) * 100;
                setProgress(percentage);
                
                if (percentage < 95) {
                    onUpdateProgress({ bookId: book.id, progress: percentage });
                }
            };

            const isBookmarked = bookmarks.includes(book.id);
           // ... inside ReaderView (around line 906)
Â  Â  Â  Â  Â  Â  const likeCount = likes[book.id] || book.likes;

Â  Â  Â  Â  Â  Â  return React.createElement('div', {
Â  Â  Â  Â  Â  Â  Â  Â  className: `fixed inset-0 z-50 flex flex-col ${isDark ? 'bg-gray-900 text-white' : 'bg-white text-gray-800'} transition-colors duration-300`
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  // Header Bar
Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: `flex items-center justify-between p-4 shadow-md ${isDark ? 'bg-gray-800 border-b border-gray-700' : 'bg-white border-b border-gray-100'}`
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('button', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick: onClose,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: `p-2 rounded-full transition ${isDark ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 'â† Back'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', { className: "text-lg font-semibold truncate max-w-xs sm:max-w-md" }, book.title),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', { className: "flex items-center gap-2" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('button', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick: () => setFontSize(s => Math.min(s + 2, 32)),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: `p-2 rounded-full transition text-xl ${isDark ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 'A+'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('button', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick: () => setFontSize(s => Math.max(s - 2, 14)),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: `p-2 rounded-full transition text-sm ${isDark ? 'hover:bg-gray-700' : 'hover:bg-gray-100'}`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 'A-')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  ),
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Reading Content Area
Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ref: contentRef,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onScroll: handleScroll,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: "flex-1 overflow-y-auto p-4 sm:p-8 no-scrollbar"
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', { className: "max-w-3xl mx-auto" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Metadata
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', { className: "mb-6 text-center" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('h2', { className: "text-4xl font-extrabold mb-1" }, book.title),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('p', { className: `text-xl font-medium ${isDark ? 'text-indigo-300' : 'text-indigo-600'} mb-4` }, `by ${book.author}`),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', { className: "flex justify-center gap-4 text-sm" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('span', { className: `px-3 py-1 rounded-full text-xs font-semibold ${isDark ? 'bg-gray-700 text-gray-300' : 'bg-gray-100 text-gray-600'}` }, book.category),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('span', { className: `px-3 py-1 rounded-full text-xs font-semibold ${isDark ? 'bg-gray-700 text-gray-300' : 'bg-gray-100 text-gray-600'}` }, `${book.readTimeMin} min read`)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Content
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: `prose ${isDark ? 'prose-invert prose-p:text-gray-300' : 'prose-p:text-gray-700'} max-w-none space-y-4 leading-relaxed transition-all`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style: { fontSize: `${fontSize}px` },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dangerouslySetInnerHTML: { __html: marked.parse(book.content) }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // End of Story/Actions
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', { className: `mt-10 pt-6 border-t ${isDark ? 'border-gray-700' : 'border-gray-200'} flex justify-between items-center` },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('button', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick: () => onLike(book.id),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: "flex items-center gap-2 px-4 py-2 rounded-full transition bg-red-100 text-red-600 hover:bg-red-200"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 'â¤ï¸', likeCount),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('button', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick: () => onToggleBookmark(book.id),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: `flex items-center gap-2 px-4 py-2 rounded-full transition ${
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isBookmarked ? 'bg-yellow-400 text-white hover:bg-yellow-500' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, isBookmarked ? 'Bookmarked ðŸ”–' : 'Bookmark'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  ),
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Progress Bar
Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', { className: `w-full h-1 ${isDark ? 'bg-gray-700' : 'bg-gray-200'} sticky bottom-0` },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: "h-full bg-indigo-500 transition-all duration-300",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  style: { width: `${progress}%` }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  ),

Â  Â  Â  Â  Â  Â  Â  Â  // Related Stories (Footer)
Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', { className: `p-4 sm:p-8 ${isDark ? 'bg-gray-800 border-t border-gray-700' : 'bg-gray-50 border-t border-gray-200'}` },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', { className: "max-w-3xl mx-auto" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('h3', { className: "text-xl font-bold mb-4" }, "More Stories Like This"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  relatedBooks.length > 0 ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', { className: "flex flex-col sm:flex-row gap-4" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  relatedBooks.map(relBook =>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key: relBook.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: "flex-1 cursor-pointer hover:text-indigo-500 transition",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick: () => { onClose(); onRead(relBook); }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('img', { src: relBook.cover, alt: relBook.title, className: "w-full h-24 object-cover rounded-lg mb-2" }),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('p', { className: "font-medium text-sm line-clamp-2" }, relBook.title),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('p', { className: `text-xs ${isDark ? 'text-gray-400' : 'text-gray-500'}` }, relBook.author)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('p', { className: `${isDark ? 'text-gray-400' : 'text-gray-500'}` }, "No related stories found.")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  };


Â  Â  Â  Â  const AddBookModal = ({ isOpen, onClose, onSubmit, isDark }) => {
Â  Â  Â  Â  Â  Â  const [title, setTitle] = useState('');
Â  Â  Â  Â  Â  Â  const [author, setAuthor] = useState('');
Â  Â  Â  Â  Â  Â  const [category, setCategory] = useState('');
Â  Â  Â  Â  Â  Â  const [description, setDescription] = useState('');

Â  Â  Â  Â  Â  Â  const handleSubmit = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  onSubmit({ title, author, category, description });
Â  Â  Â  Â  Â  Â  Â  Â  onClose();
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const inputClass = `w-full p-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition ${isDark ? 'bg-gray-700 border-gray-600 text-white' : 'bg-gray-50 border-gray-300 text-gray-900'}`;
Â  Â  Â  Â  Â  Â  const labelClass = `block text-sm font-medium mb-1 ${isDark ? 'text-gray-300' : 'text-gray-700'}`;

Â  Â  Â  Â  Â  Â  return React.createElement(Modal, { isOpen: isOpen, onClose: onClose, title: "Suggest a Story", isDark: isDark },
Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('form', { onSubmit: handleSubmit, className: "space-y-4" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('label', { className: labelClass }, "Title"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('input', { type: "text", value: title, onChange: (e) => setTitle(e.target.value), required: true, className: inputClass })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('label', { className: labelClass }, "Author (Your Name)"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('input', { type: "text", value: author, onChange: (e) => setAuthor(e.target.value), required: true, className: inputClass })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('label', { className: labelClass }, "Category/Type"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('input', { type: "text", value: category, onChange: (e) => setCategory(e.target.value), required: true, className: inputClass })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', null,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('label', { className: labelClass }, "Short Description"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('textarea', { value: description, onChange: (e) => setDescription(e.target.value), required: true, className: inputClass, rows: 3 })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('button', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: "submit",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: "w-full p-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, "Submit Suggestion")
Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  };

Â  Â  Â  Â  const BookmarkModal = ({ isOpen, onClose, bookmarks, books, onRead, onToggleBookmark, onLike, likes, isDark }) => {
Â  Â  Â  Â  Â  Â  const bookmarkedStories = bookmarks
Â  Â  Â  Â  Â  Â  Â  Â  .map(id => books.find(b => b.id === id))
Â  Â  Â  Â  Â  Â  Â  Â  .filter(book => book);

Â  Â  Â  Â  Â  Â  return React.createElement(Modal, { isOpen: isOpen, onClose: onClose, title: "Your Bookmarks", isDark: isDark },
Â  Â  Â  Â  Â  Â  Â  Â  bookmarkedStories.length === 0 ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('p', { className: `${isDark ? 'text-gray-400' : 'text-gray-600'}` }, "You haven't bookmarked any stories yet. Start exploring the library!")
Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', { className: "space-y-4" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bookmarkedStories.map(book =>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  key: book.id,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: `flex items-center p-3 rounded-lg border transition ${isDark ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-100'}`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('img', { src: book.cover, alt: book.title, className: "w-12 h-12 object-cover rounded-md mr-4" }),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('div', { className: "flex-1" },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('p', { className: `font-semibold cursor-pointer hover:text-indigo-500 ${isDark ? 'text-white' : 'text-gray-900'}`, onClick: () => { onClose(); onRead(book); } }, book.title),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('p', { className: `text-sm ${isDark ? 'text-gray-400' : 'text-gray-600'}` }, `by ${book.author}`)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('button', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick: () => onToggleBookmark(book.id),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: "text-red-500 hover:text-red-700 p-2 ml-4"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 'âŒ')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  };


Â  Â  Â  Â  // --- Main App Component ---
Â  Â  Â  Â  const App = () => {
Â  Â  Â  Â  Â  Â  const [books, setBooks] = useState([]);
Â  Â  Â  Â  Â  Â  const [isLoading, setIsLoading] = useState(true);
Â  Â  Â  Â  Â  Â  const [currentBook, setCurrentBook] = useState(null);
Â  Â  Â  Â  Â  Â  const [bookmarks, setBookmarks] = useState(() => JSON.parse(localStorage.getItem('mythmehalfway_bookmarks') || '[]'));
Â  Â  Â  Â  Â  Â  const [likes, setLikes] = useState(() => JSON.parse(localStorage.getItem('mythmehalfway_likes') || '{}'));
Â  Â  Â  Â  Â  Â  const [readingStats, setReadingStats] = useState(() => JSON.parse(localStorage.getItem('mythmehalfway_stats') || '{ "totalMinutes": 0, "booksRead": 0 }'));
Â  Â  Â  Â  Â  Â  const [lastReadPosition, setLastReadPosition] = useState(() => JSON.parse(localStorage.getItem('mythmehalfway_last_read') || '{ "bookId": null, "progress": 0 }'));
Â  Â  Â  Â  Â  Â  const [activeSound, setActiveSound] = useState(null);
Â  Â  Â  Â  Â  Â  const [isDark, setIsDark] = useState(false);
Â  Â  Â  Â  Â  Â  const [notification, setNotification] = useState(null);

Â  Â  Â  Â  Â  Â  const [showAddBook, setShowAddBook] = useState(false);
Â  Â  Â  Â  Â  Â  const [showBookmarks, setShowBookmarks] = useState(false);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const showNotification = (message, type = 'info') => {
Â  Â  Â  Â  Â  Â  Â  Â  setNotification({ message, type });
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => setNotification(null), 3000);
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  useEffect(() => {
Â  Â  Â  Â  Â  Â  Â  Â  // Load stories on mount
Â  Â  Â  Â  Â  Â  Â  Â  const loadStories = async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const apiStories = await fetchStoriesFromAPI();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setBooks(apiStories);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn('API fetch failed, falling back to dummy data:', e.message);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setBooks(getFallbackStories());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Could not connect to API. Using local stories.', 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsLoading(false);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  // Load Marked.js for markdown rendering
Â  Â  Â  Â  Â  Â  Â  Â  if (typeof marked === 'undefined') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const script = document.createElement('script');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  script.src = "https://cdn.jsdelivr.net/npm/marked/marked.min.js";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  script.onload = loadStories;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.head.appendChild(script);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadStories();
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Dark Mode based on system preference
Â  Â  Â  Â  Â  Â  Â  Â  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
Â  Â  Â  Â  Â  Â  Â  Â  setIsDark(prefersDark);
Â  Â  Â  Â  Â  Â  Â  Â  document.body.className = prefersDark ? 'bg-gray-900' : 'bg-gray-100';
Â  Â  Â  Â  Â  Â  }, []);

Â  Â  Â  Â  Â  Â  useEffect(() => {
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('mythmehalfway_bookmarks', JSON.stringify(bookmarks));
Â  Â  Â  Â  Â  Â  }, [bookmarks]);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  useEffect(() => {
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('mythmehalfway_likes', JSON.stringify(likes));
Â  Â  Â  Â  Â  Â  }, [likes]);

Â  Â  Â  Â  Â  Â  useEffect(() => {
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('mythmehalfway_stats', JSON.stringify(readingStats));
Â  Â  Â  Â  Â  Â  }, [readingStats]);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  useEffect(() => {
Â  Â  Â  Â  Â  Â  Â  Â  document.body.className = isDark ? 'bg-gray-900 transition-colors' : 'bg-gray-100 transition-colors';
Â  Â  Â  Â  Â  Â  }, [isDark]);


Â  Â  Â  Â  Â  Â  const handleRead = (book, initialScrollProgress = 0) => {
Â  Â  Â  Â  Â  Â  Â  Â  const bookWithProgress = { ...book, initialScrollProgress };
Â  Â  Â  Â  Â  Â  Â  Â  setCurrentBook(bookWithProgress);
Â  Â  Â  Â  Â  Â  Â  Â  setLastReadPosition({ bookId: book.id, progress: initialScrollProgress });
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('mythmehalfway_last_read', JSON.stringify({ bookId: book.id, progress: initialScrollProgress }));
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleCloseReader = () => {
Â  Â  Â  Â  Â  Â  Â  Â  // Check if story was finished
Â  Â  Â  Â  Â  Â  Â  Â  if (lastReadPosition.bookId === currentBook.id && lastReadPosition.progress > 95) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setReadingStats(prev => ({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalMinutes: prev.totalMinutes + currentBook.readTimeMin,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  booksRead: prev.booksRead + 1
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification(`Completed: ${currentBook.title}!`, 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLastReadPosition({ bookId: null, progress: 0 }); // Clear completed book from 'Continue Reading'
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Only show this if they started the book
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (lastReadPosition.progress > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Progress Saved.', 'info');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  setCurrentBook(null);
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleUpdateProgress = (progressData) => {
Â  Â  Â  Â  Â  Â  Â  Â  setLastReadPosition(progressData);
Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('mythmehalfway_last_read', JSON.stringify(progressData));
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleResumeReading = () => {
Â  Â  Â  Â  Â  Â  Â  Â  const book = books.find(b => b.id === lastReadPosition.bookId);
Â  Â  Â  Â  Â  Â  Â  Â  if (book) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  handleRead(book, lastReadPosition.progress);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleToggleBookmark = (bookId) => {
Â  Â  Â  Â  Â  Â  Â  Â  setBookmarks(prev => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isBookmarked = prev.includes(bookId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let newBookmarks;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isBookmarked) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newBookmarks = prev.filter(id => id !== bookId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Bookmark Removed', 'info');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newBookmarks = [...prev, bookId];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Bookmarked!', 'success');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return newBookmarks;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleLike = (bookId) => {
Â  Â  Â  Â  Â  Â  Â  Â  setLikes(prev => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentLikes = prev[bookId] || (books.find(b => b.id === bookId)?.likes || 0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newLikes = { ...prev };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (prev[bookId] === currentLikes + 1) { // User unlikes
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newLikes[bookId] = currentLikes - 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { // User likes
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newLikes[bookId] = currentLikes + 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return newLikes;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  const handleToggleSound = (sound) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!sound || activeSound?.id === sound.id) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setActiveSound(null);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Background audio stopped.', 'info');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setActiveSound(sound);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showNotification(`Now playing: ${sound.name}`, 'info');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const handleSuggestStory = (suggestion) => {
Â  Â  Â  Â  Â  Â  Â  Â  console.log("Story Suggestion:", suggestion);
Â  Â  Â  Â  Â  Â  Â  Â  showNotification('Thank you for your suggestion!', 'success');
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  return React.createElement(React.Fragment, null,
Â  Â  Â  Â  Â  Â  Â  Â  // Main View
Â  Â  Â  Â  Â  Â  Â  Â  currentBook ? (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement(ReaderView, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  book: currentBook,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  books: books,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClose: handleCloseReader,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isDark: isDark,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bookmarks: bookmarks,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  likes: likes,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onToggleBookmark: handleToggleBookmark,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onLike: handleLike,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onRead: handleRead,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onUpdateProgress: handleUpdateProgress
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  React.createElement(LibraryView, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  books: books,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  readingStats: readingStats,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bookmarks: bookmarks,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  likes: likes,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onRead: handleRead,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onToggleBookmark: handleToggleBookmark,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onLike: handleLike,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setShowAddBook: setShowAddBook,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setShowBookmarks: setShowBookmarks,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isDark: isDark,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastReadPosition: lastReadPosition,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onResumeReading: handleResumeReading,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isLoading: isLoading
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  ),

Â  Â  Â  Â  Â  Â  Â  Â  // Floating Widgets
Â  Â  Â  Â  Â  Â  Â  Â  React.createElement('button', {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClick: () => setIsDark(prev => !prev),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className: `fixed top-6 right-6 p-3 rounded-full shadow-lg z-40 transition transform hover:scale-110 ${isDark ? 'bg-gray-800 text-yellow-400 border border-gray-700' : 'bg-white text-gray-800 border border-gray-200'}`
Â  Â  Â  Â  Â  Â  Â  Â  }, isDark ? 'â˜€ï¸' : 'ðŸŒ™'),

Â  Â  Â  Â  Â  Â  Â  Â  React.createElement(SoundWidget, { activeSound: activeSound, onToggleSound: handleToggleSound, isDark: isDark }),

Â  Â  Â  Â  Â  Â  Â  Â  // Modals
Â  Â  Â  Â  Â  Â  Â  Â  React.createElement(AddBookModal, { isOpen: showAddBook, onClose: () => setShowAddBook(false), onSubmit: handleSuggestStory, isDark: isDark }),
Â  Â  Â  Â  Â  Â  Â  Â  React.createElement(BookmarkModal, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isOpen: showBookmarks,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClose: () => setShowBookmarks(false),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bookmarks: bookmarks,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  books: books,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onRead: handleRead,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onToggleBookmark: handleToggleBookmark,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onLike: handleLike,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  likes: likes,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isDark: isDark
Â  Â  Â  Â  Â  Â  Â  Â  }),

Â  Â  Â  Â  Â  Â  Â  Â  // Notifications
Â  Â  Â  Â  Â  Â  Â  Â  notification && React.createElement(Notification, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  message: notification.message,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: notification.type,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onClose: () => setNotification(null)
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  };

Â  Â  Â  Â  // Render the app
Â  Â  Â  Â  // Using createRoot for React 18 compatibility as indicated by your CDN scripts
Â  Â  Â  Â  if (typeof ReactDOM.createRoot === 'function') {
Â  Â  Â  Â  Â  Â  const root = ReactDOM.createRoot(document.getElementById('root'));
Â  Â  Â  Â  Â  Â  root.render(React.createElement(App));
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Fallback for older React versions
Â  Â  Â  Â  Â  Â  ReactDOM.render(React.createElement(App), document.getElementById('root'));
Â  Â  Â  Â  }
Â  Â  </script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>
</html>
