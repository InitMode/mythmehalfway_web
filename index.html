<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hadithi Stories</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #f0f0f0;
        margin: 0;
        padding: 20px;
    }
    h1 {
        text-align: center;
        margin-bottom: 20px;
    }
    .story-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
        padding: 10px;
    }
    .story-card {
        background: #1d1d1d;
        padding: 15px;
        border-radius: 10px;
        cursor: pointer;
        transition: 0.2s;
        border: 1px solid #333;
    }
    .story-card:hover {
        background: #272727;
        transform: scale(1.02);
    }
    .pagination {
        text-align: center;
        margin-top: 20px;
    }
    .pagination button {
        background: #333;
        color: white;
        border: none;
        padding: 10px 14px;
        margin: 5px;
        cursor: pointer;
        border-radius: 8px;
    }
    .pagination button.active {
        background: #007bff;
    }
    .pagination button:hover {
        background: #555;
    }
</style>
</head>

<body>

<h1>ðŸ“š Hadithi Stories</h1>

<div id="storyContainer" class="story-list"></div>
<div id="pagination" class="pagination"></div>

<script>
const API_URL = "/api/stories/index.json";
const ITEMS_PER_PAGE = 10;
let stories = [];
let currentPage = 1;

async function loadStories() {
    try {
        const res = await fetch(API_URL);
        const data = await res.json();

        stories = data.filter(f => f.endsWith(".md"));
        stories.sort(); // ensures story0001.md comes before story0010.md

        renderPage(currentPage);
        renderPagination();
    } catch (error) {
        console.error("Failed to load stories:", error);
    }
}

function renderPage(page) {
    const container = document.getElementById("storyContainer");
    container.innerHTML = "";

    const start = (page - 1) * ITEMS_PER_PAGE;
    const end = start + ITEMS_PER_PAGE;

    const pageItems = stories.slice(start, end);

    pageItems.forEach(filename => {
        const id = filename.replace(".md", "").toUpperCase();

        const card = document.createElement("div");
        card.className = "story-card";
        card.innerHTML = `<h3>${id}</h3><p>Read Story â†’</p>`;
        card.onclick = () => openStory(filename);

        container.appendChild(card);
    });
}

function renderPagination() {
    const totalPages = Math.ceil(stories.length / ITEMS_PER_PAGE);
    const pagDiv = document.getElementById("pagination");
    pagDiv.innerHTML = "";

    if (totalPages <= 1) return; // Hide pagination if not needed

    // Prev Button
    const prevBtn = document.createElement("button");
    prevBtn.textContent = "Prev";
    prevBtn.onclick = () => changePage(currentPage - 1);
    prevBtn.disabled = currentPage === 1;
    pagDiv.appendChild(prevBtn);

    // Page numbers
    for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        if (i === currentPage) btn.classList.add("active");
        btn.onclick = () => changePage(i);
        pagDiv.appendChild(btn);
    }

    // Next Button
    const nextBtn = document.createElement("button");
    nextBtn.textContent = "Next";
    nextBtn.onclick = () => changePage(currentPage + 1);
    nextBtn.disabled = currentPage === totalPages;
    pagDiv.appendChild(nextBtn);
}

function changePage(page) {
    const totalPages = Math.ceil(stories.length / ITEMS_PER_PAGE);
    if (page < 1 || page > totalPages) return;
    currentPage = page;
    renderPage(currentPage);
    renderPagination();
}

function openStory(filename) {
    window.location.href = `/api/stories/${filename}`;
}

loadStories();
</script>

</body>
</html>
